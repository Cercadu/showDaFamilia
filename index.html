<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üéÆ SHOW DA FAM√çLIA - Edi√ß√£o Definitiva üèÜ</title>
  <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&family=Nunito:wght@400;700;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    :root {
      --primary: #4f46e5;
      --secondary: #f59e0b;
      --success: #10b981;
      --danger: #ef4444;
      --warning: #f59e0b;
      --info: #3b82f6;
      --dark: #0f172a;
      --light: #f8fafc;
      --family-red: #ef4444;
      --family-blue: #3b82f6;
      --family-yellow: #f59e0b;
      --family-green: #10b981;
      --family-purple: #8b5cf6;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      background: linear-gradient(135deg, #0f172a 0%, #1e40af 100%);
      color: var(--light);
      font-family: 'Nunito', system-ui, sans-serif;
      min-height: 100vh;
      padding: 20px;
      overflow-x: hidden;
    }

    #app { max-width: 1400px; margin: 0 auto; padding: 20px; }

    .main-card {
      background: rgba(15, 23, 42, 0.95);
      border-radius: 24px;
      padding: 30px;
      box-shadow: 0 10px 40px rgba(79, 70, 229, 0.3), 0 0 60px rgba(245, 158, 11, 0.1);
      border: 3px solid rgba(79, 70, 229, 0.3);
      backdrop-filter: blur(10px);
      position: relative;
      overflow: hidden;
    }

    .game-header {
      text-align: center;
      margin-bottom: 40px;
      padding: 25px;
      background: linear-gradient(90deg,
        var(--family-red),
        var(--family-yellow),
        var(--family-green),
        var(--family-blue),
        var(--family-purple));
      border-radius: 20px;
      position: relative;
      overflow: hidden;
      animation: headerGlow 3s infinite alternate;
    }

    .game-header h1 {
      font-family: 'Comic Neue', cursive;
      font-size: 4rem;
      color: white;
      text-shadow: 0 2px 4px rgba(0,0,0,0.3), 0 0 30px rgba(255, 255, 255, 0.5);
      margin-bottom: 10px;
      animation: textGlow 2s ease-in-out infinite alternate;
    }

    .game-subtitle {
      font-size: 1.3rem;
      opacity: 0.95;
      color: white;
      font-weight: 600;
    }

    @keyframes headerGlow {
      0% { box-shadow: 0 0 20px var(--family-red); }
      25% { box-shadow: 0 0 20px var(--family-yellow); }
      50% { box-shadow: 0 0 20px var(--family-green); }
      75% { box-shadow: 0 0 20px var(--family-blue); }
      100% { box-shadow: 0 0 20px var(--family-purple); }
    }

    @keyframes textGlow {
      from { text-shadow: 0 0 20px rgba(255, 255, 255, 0.5); }
      to { text-shadow: 0 0 30px rgba(255, 255, 255, 0.8), 0 0 40px rgba(245, 158, 11, 0.6); }
    }

    @keyframes pulse { 0%{transform:scale(1)} 50%{transform:scale(1.05)} 100%{transform:scale(1)} }
    @keyframes bounce { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-10px)} }
    @keyframes confettiRain { 0%{transform:translateY(-100vh) rotate(0deg)} 100%{transform:translateY(100vh) rotate(360deg)} }
    @keyframes slideIn { from{transform:translateX(100%);opacity:0} to{transform:translateX(0);opacity:1} }
    @keyframes slideOut { from{transform:translateX(0);opacity:1} to{transform:translateX(100%);opacity:0} }

    .btn {
      padding: 18px 28px;
      border: none;
      border-radius: 16px;
      font-size: 1.1rem;
      font-weight: 800;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      margin: 12px 0;
      width: 100%;
      font-family: 'Comic Neue', cursive;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .btn:hover {
      transform: translateY(-5px) scale(1.05);
      box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
    }

    .btn-primary { background: linear-gradient(135deg, var(--primary), #6366f1); color: white; }
    .btn-secondary { background: linear-gradient(135deg, var(--secondary), #fbbf24); color: white; }
    .btn-success { background: linear-gradient(135deg, var(--success), #34d399); color: white; }
    .btn-danger { background: linear-gradient(135deg, var(--danger), #f87171); color: white; }
    .btn-warning { background: linear-gradient(135deg, var(--warning), #fbbf24); color: white; }
    .btn-family { background: linear-gradient(135deg, var(--family-red), var(--family-yellow)); color: white; animation: pulse 2s infinite; }

    .top-controls {
      position: fixed;
      top: 20px;
      right: 20px;
      display: flex;
      gap: 10px;
      z-index: 100;
    }

    .control-btn {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      border: none;
      background: rgba(15, 23, 42, 0.9);
      color: white;
      font-size: 1.2rem;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .control-btn:hover { transform: scale(1.1); background: rgba(79, 70, 229, 0.9); }

    .mode-selection {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 25px;
      margin: 30px 0;
    }

    .mode-card {
      background: rgba(30, 41, 59, 0.8);
      border-radius: 20px;
      padding: 25px;
      border: 2px solid transparent;
      transition: all 0.3s;
      text-align: center;
      cursor: pointer;
    }

    .mode-card:hover {
      border-color: var(--secondary);
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(245, 158, 11, 0.2);
    }

    .mode-card.selected { border-color: var(--success); background: rgba(16, 185, 129, 0.1); }

    .mode-icon { font-size: 3rem; margin-bottom: 15px; }

    .settings-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 25px;
      margin: 30px 0;
    }

    .setting-group { margin-bottom: 25px; }
    .setting-label { display: block; margin-bottom: 10px; font-size: 1.2rem; color: #cbd5e1; font-weight: 700; }

    .setting-input {
      width: 100%;
      padding: 18px 22px;
      border: 2px solid #334155;
      border-radius: 14px;
      font-size: 1.1rem;
      background: rgba(30, 41, 59, 0.9);
      color: white;
      transition: all 0.3s;
    }

    .setting-input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 4px rgba(79, 70, 229, 0.2);
    }

    .slider-value { text-align: center; font-size: 1.8rem; color: var(--secondary); font-weight: 900; margin-top: 10px; }

    .players-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px;
      margin: 30px 0;
    }

    .player-card {
      background: rgba(30, 41, 59, 0.9);
      border-radius: 18px;
      padding: 20px;
      text-align: center;
      border: 3px solid transparent;
      transition: all 0.3s;
      position: relative;
    }

    .player-card.current {
      border-color: var(--secondary);
      box-shadow: 0 0 30px rgba(245, 158, 11, 0.4);
      animation: pulse 2s infinite;
    }

    .player-avatar { font-size: 3.5rem; margin-bottom: 15px; display: block; animation: bounce 2s infinite; }

    .game-area {
      background: rgba(30, 41, 59, 0.95);
      border-radius: 24px;
      padding: 30px;
      margin: 30px 0;
      border-left: 8px solid var(--primary);
    }

    .turn-info { text-align: center; margin-bottom: 25px; padding: 15px; background: rgba(79, 70, 229, 0.2); border-radius: 15px; }
    .turn-text { font-size: 1.8rem; color: var(--secondary); font-weight: 900; }

    .category-badge {
      display: inline-block;
      padding: 10px 20px;
      background: rgba(79, 70, 229, 0.2);
      border-radius: 25px;
      font-size: 1rem;
      font-weight: 700;
      margin: 15px 0;
      color: #818cf8;
    }

    .question-container {
      min-height: 200px;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 30px;
      margin: 30px 0;
      background: rgba(15, 23, 42, 0.7);
      border-radius: 20px;
      border: 3px solid var(--primary);
    }

    .question-text { font-size: 2.2rem; line-height: 1.5; color: white; font-weight: 700; text-align: center; }

    .answers-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin: 30px 0;
    }

    .answer-option {
      padding: 25px;
      background: rgba(51, 65, 85, 0.9);
      border: 3px solid transparent;
      border-radius: 18px;
      color: white;
      font-size: 1.2rem;
      cursor: pointer;
      transition: all 0.3s;
      position: relative;
      overflow: hidden;
    }

    .answer-option:hover { background: rgba(71, 85, 105, 0.95); transform: translateX(10px); border-color: var(--info); }
    .answer-option.correct { background: linear-gradient(135deg, var(--success), #34d399); border-color: var(--success); animation: pulse 0.5s; }
    .answer-option.wrong { background: linear-gradient(135deg, var(--danger), #f87171); border-color: var(--danger); }

    .answer-letter { position: absolute; left: 20px; font-weight: 900; color: rgba(255, 255, 255, 0.3); font-size: 1.5rem; }
    .answer-content { margin-left: 50px; }

    .timer-container { margin: 25px 0; }
    .timer-bar { height: 15px; background: rgba(71, 85, 105, 0.5); border-radius: 10px; overflow: hidden; margin-bottom: 10px; }
    .timer-fill { height: 100%; background: linear-gradient(90deg, var(--success), var(--warning), var(--danger)); width: 100%; transition: width 1s linear; border-radius: 10px; }
    .timer-text { text-align: center; font-size: 1.3rem; color: var(--warning); font-weight: 700; }

    .powerups-container { display: flex; justify-content: center; gap: 20px; margin: 30px 0; flex-wrap: wrap; }

    .powerup-btn {
      padding: 15px 25px;
      background: rgba(139, 92, 246, 0.9);
      border: none;
      border-radius: 15px;
      color: white;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .powerup-btn:hover { transform: scale(1.1); background: rgba(139, 92, 246, 1); }
    .powerup-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

    .scoreboard {
      background: rgba(15, 23, 42, 0.95);
      border-radius: 20px;
      padding: 25px;
      margin: 30px 0;
      border: 3px solid rgba(79, 70, 229, 0.3);
    }

    .scoreboard-title { text-align: center; font-size: 2rem; margin-bottom: 25px; color: var(--secondary); font-weight: 900; }
    .scores-list { display: grid; gap: 15px; }

    .score-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px;
      background: rgba(30, 41, 59, 0.7);
      border-radius: 15px;
      transition: all 0.3s;
      border-left: 5px solid transparent;
      gap: 10px;
    }

    .score-item.current { background: rgba(79, 70, 229, 0.2); border-left-color: var(--primary); }

    .score-player { font-weight: 800; font-size: 1.3rem; display: flex; align-items: center; gap: 10px; flex-wrap: wrap; }
    .score-points { font-weight: 900; font-size: 1.8rem; color: var(--secondary); }

    .results-screen { text-align: center; padding: 40px; }
    .winner-crown { font-size: 5rem; margin-bottom: 20px; animation: bounce 2s infinite; }
    .winner-title { font-size: 3rem; color: var(--secondary); margin-bottom: 20px; }
    .winner-score { font-size: 2.5rem; color: var(--warning); margin-bottom: 30px; }

    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      z-index: 2000;
      align-items: center;
      justify-content: center;
      backdrop-filter: blur(5px);
    }

    .modal-content {
      background: var(--dark);
      border-radius: 30px;
      padding: 40px;
      max-width: 800px;
      width: 90%;
      max-height: 90vh;
      overflow-y: auto;
      border: 4px solid var(--secondary);
      animation: modalSlide 0.4s ease-out;
    }

    @keyframes modalSlide {
      from { opacity: 0; transform: translateY(-60px) scale(0.9); }
      to { opacity: 1; transform: translateY(0) scale(1); }
    }

    .confetti { position: fixed; width: 15px; height: 15px; pointer-events: none; z-index: 10000; animation: confettiRain 5s linear forwards; }

    .hidden { display: none !important; }
    .text-center { text-align: center; }
    .mt-20 { margin-top: 20px; }
    .mt-30 { margin-top: 30px; }
    .mb-20 { margin-bottom: 20px; }
    .mb-30 { margin-bottom: 30px; }

    @media (max-width: 1200px) {
      .game-header h1 { font-size: 3rem; }
      .answers-container { grid-template-columns: repeat(2, 1fr); }
    }

    @media (max-width: 768px) {
      .game-header h1 { font-size: 2.5rem; }
      .answers-container { grid-template-columns: 1fr; }
      .question-text { font-size: 1.8rem; }
      .mode-selection { grid-template-columns: 1fr; }
      .settings-grid { grid-template-columns: 1fr; }
      .players-grid { grid-template-columns: 1fr; }
      .powerups-container { flex-direction: column; align-items: center; }
      .top-controls { top: 10px; right: 10px; }
      .control-btn { width: 40px; height: 40px; font-size: 1rem; }
    }

    @media (max-width: 480px) {
      .game-header h1 { font-size: 2rem; }
      .btn { padding: 15px 20px; font-size: 1rem; }
      .modal-content { padding: 20px; }
      .winner-title { font-size: 2rem; }
    }
  </style>
</head>

<body>
<div id="app">
  <div class="main-card">

    <div class="top-controls">
      <button class="control-btn" id="audioToggle" title="Alternar som">
        <i class="fas fa-volume-up"></i>
      </button>
      <button class="control-btn" id="voiceToggle" title="Alternar voz">
        <i class="fas fa-microphone-alt"></i>
      </button>
      <button class="control-btn" onclick="showInstructions()" title="Instru√ß√µes">
        <i class="fas fa-question"></i>
      </button>
      <button class="control-btn" onclick="showRecords()" title="Recordes">
        <i class="fas fa-trophy"></i>
      </button>
    </div>

    <header class="game-header">
      <h1>üéÆ SHOW DA FAM√çLIA üéÆ</h1>
      <p class="game-subtitle">O jogo mais completo para toda a fam√≠lia!</p>
    </header>

    <div id="welcomeScreen">
      <div class="text-center mb-30">
        <h2 style="font-size: 2.5rem; color: var(--secondary); margin-bottom: 20px;">
          <i class="fas fa-users"></i> BEM-VINDO, FAM√çLIA!
        </h2>
        <p style="font-size: 1.3rem; color: #cbd5e1; max-width: 800px; margin: 0 auto 30px;">
          Escolha o modo de jogo e prepare-se para horas de divers√£o, aprendizado e muitas risadas!
        </p>
      </div>

      <div class="setting-group">
        <label class="setting-label"><i class="fas fa-gamepad"></i> ESCOLHA O MODO DE JOGO</label>
        <div class="mode-selection">
          <div class="mode-card" onclick="selectMode('classic')">
            <div class="mode-icon">üèÜ</div>
            <h3>CL√ÅSSICO</h3>
            <p>Todos contra todos, rodadas infinitas</p>
          </div>
          <div class="mode-card" onclick="selectMode('quick')">
            <div class="mode-icon">‚ö°</div>
            <h3>R√ÅPIDO</h3>
            <p>5, 10 ou 15 rodadas por jogador</p>
          </div>
          <div class="mode-card" onclick="selectMode('duel')">
            <div class="mode-icon">‚öîÔ∏è</div>
            <h3>DUELO X1</h3>
            <p>Batalha cara a cara, melhor de 3</p>
          </div>
          <div class="mode-card" onclick="selectMode('single')">
            <div class="mode-icon">üë§</div>
            <h3>UM JOGADOR</h3>
            <p>Desafie o computador sozinho</p>
          </div>
          <div class="mode-card" onclick="selectMode('teams')">
            <div class="mode-icon">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</div>
            <h3>TIMES</h3>
            <p>Crian√ßas vs Adultos ou times mistos</p>
          </div>
          <div class="mode-card" onclick="selectMode('survival')">
            <div class="mode-icon">üî•</div>
            <h3>SURVIVAL</h3>
            <p>Errou, sai! √öltimo sobrevivente ganha</p>
          </div>
          <div class="mode-card" onclick="selectMode('coop')">
            <div class="mode-icon">ü§ù</div>
            <h3>COOPERATIVO</h3>
            <p>Todos juntos contra o tempo</p>
          </div>
        </div>
      </div>

      <div class="settings-grid">
        <div class="setting-group">
          <label class="setting-label"><i class="fas fa-user-friends"></i> QUANTOS JOGADORES?</label>
          <input type="range" id="numPlayers" min="1" max="8" value="4" class="setting-input">
          <div class="slider-value" id="playerCount">4 JOGADORES</div>
        </div>

        <div class="setting-group">
          <label class="setting-label"><i class="fas fa-brain"></i> N√çVEL DE DIFICULDADE</label>
          <select id="difficulty" class="setting-input">
            <option value="easy">ü•á F√ÅCIL (Para todos)</option>
            <option value="medium" selected>ü•à M√âDIO (Fam√≠lia)</option>
            <option value="hard">ü•á DIF√çCIL (Experts)</option>
            <option value="expert">üëë EXPERT (Desafio Total)</option>
            <option value="mixed">üé≤ MISTURADO (Todos os n√≠veis)</option>
          </select>
        </div>

        <div class="setting-group">
          <label class="setting-label"><i class="fas fa-flag-checkered"></i> QUANTAS RODADAS?</label>
          <select id="rounds" class="setting-input">
            <option value="5">5 Rodadas (R√°pido)</option>
            <option value="10" selected>10 Rodadas (Normal)</option>
            <option value="15">15 Rodadas (Longo)</option>
            <option value="20">20 Rodadas (Maratona)</option>
            <option value="infinite">Infinitas (At√© cansar!)</option>
          </select>
        </div>
      </div>

      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 40px;">
        <button class="btn btn-family" onclick="setupPlayers()">
          <i class="fas fa-play-circle"></i> COME√áAR JOGO
        </button>
        <button class="btn btn-secondary" onclick="showQuickStats()">
          <i class="fas fa-chart-line"></i> ESTAT√çSTICAS
        </button>
      </div>

      <div id="quickStats" class="scoreboard mt-30" style="display: none;">
        <h3 class="scoreboard-title"><i class="fas fa-chart-pie"></i> ESTAT√çSTICAS DA FAM√çLIA</h3>
        <div id="statsList"></div>
      </div>
    </div>

    <div id="playerSetup" class="hidden">
      <h2 style="color: var(--secondary); margin-bottom: 30px; text-align: center;">
        <i class="fas fa-user-edit"></i> CONFIGURE OS JOGADORES
      </h2>

      <div class="players-grid" id="playersGrid"></div>

      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 40px;">
        <button class="btn btn-success" onclick="startGame()">
          <i class="fas fa-rocket"></i> INICIAR PARTIDA!
        </button>
        <button class="btn btn-secondary" onclick="backToMenu()">
          <i class="fas fa-arrow-left"></i> VOLTAR
        </button>
      </div>
    </div>

    <div id="gameScreen" class="hidden">
      <div class="turn-info">
        <div id="turnText" class="turn-text"></div>
        <div id="categoryDisplay" class="category-badge"></div>
      </div>

      <div class="timer-container">
        <div class="timer-bar">
          <div id="timerFill" class="timer-fill"></div>
        </div>
        <div id="timerText" class="timer-text">TEMPO: 30s</div>
      </div>

      <div class="game-area">
        <div class="question-container">
          <div id="questionDisplay" class="question-text"></div>
        </div>

        <div id="answersContainer" class="answers-container"></div>

        <div class="powerups-container">
          <button class="powerup-btn" onclick="usePowerUp('help')" id="helpBtn">
            <i class="fas fa-life-ring"></i> AJUDA DA FAM√çLIA (2)
          </button>
          <button class="powerup-btn" onclick="usePowerUp('time')" id="timeBtn">
            <i class="fas fa-clock"></i> TEMPO EXTRA (1)
          </button>
          <button class="powerup-btn" onclick="usePowerUp('double')" id="doubleBtn">
            <i class="fas fa-gem"></i> DUPLA PONTUA√á√ÉO (1)
          </button>
          <button class="powerup-btn" onclick="usePowerUp('skip')" id="skipBtn">
            <i class="fas fa-forward"></i> PULAR PERGUNTA (1)
          </button>
        </div>
      </div>

      <div class="scoreboard">
        <h3 class="scoreboard-title">
          <i class="fas fa-chart-bar"></i> PLACAR - RODADA
          <span id="currentRound">1</span>/<span id="totalRounds">10</span>
        </h3>
        <div id="scoreList" class="scores-list"></div>
      </div>

      <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-top: 30px;">
        <button class="btn btn-warning" onclick="pauseGame()">
          <i class="fas fa-pause"></i> PAUSAR
        </button>
        <button class="btn btn-info" onclick="showHint()" id="hintBtn">
          <i class="fas fa-lightbulb"></i> DICA (-3 pts)
        </button>
        <button class="btn btn-danger" onclick="confirmQuit()">
          <i class="fas fa-sign-out-alt"></i> SAIR
        </button>
      </div>
    </div>

    <div id="resultsScreen" class="hidden">
      <div class="results-screen">
        <div id="winnerCrown" class="winner-crown"></div>
        <h2 id="winnerTitle" class="winner-title"></h2>
        <div id="winnerScore" class="winner-score"></div>

        <div class="scoreboard mt-30">
          <h3 class="scoreboard-title"><i class="fas fa-chart-pie"></i> ESTAT√çSTICAS DA PARTIDA</h3>
          <div id="gameStats" style="text-align: left; padding: 20px;"></div>
        </div>

        <div id="achievementsDisplay" class="scoreboard mt-30" style="display: none;">
          <h3 class="scoreboard-title"><i class="fas fa-medal"></i> CONQUISTAS DESBLOQUEADAS</h3>
          <div id="achievementsList"></div>
        </div>

        <div style="display: flex; gap: 15px; justify-content: center; margin-top: 40px; flex-wrap: wrap;">
          <button class="btn btn-family" onclick="rematch()">
            <i class="fas fa-redo"></i> REVANCHE
          </button>
          <button class="btn btn-success" onclick="newGame()">
            <i class="fas fa-plus-circle"></i> NOVA PARTIDA
          </button>
          <button class="btn btn-secondary" onclick="backToMenu()">
            <i class="fas fa-home"></i> MENU PRINCIPAL
          </button>
          <button class="btn btn-info" onclick="shareResults()">
            <i class="fas fa-share-alt"></i> COMPARTILHAR
          </button>
        </div>
      </div>
    </div>

  </div>
</div>

<div id="instructionsModal" class="modal-overlay">
  <div class="modal-content">
    <h2 style="color: var(--secondary); margin-bottom: 25px; text-align: center;">
      <i class="fas fa-graduation-cap"></i> COMO JOGAR - SHOW DA FAM√çLIA
    </h2>

    <div style="line-height: 1.8; font-size: 1.1rem;">
      <p style="color:#cbd5e1; margin-bottom: 15px;">
        Escolha o modo, configure jogadores e responda perguntas. Use power-ups com estrat√©gia.
      </p>
      <ul style="list-style: none; padding-left: 10px;">
        <li style="margin: 10px 0; border-left: 3px solid var(--info); padding-left: 10px;"><strong>Cl√°ssico:</strong> sem limite pr√°tico (ou at√© acabar sua paci√™ncia).</li>
        <li style="margin: 10px 0; border-left: 3px solid var(--success); padding-left: 10px;"><strong>R√°pido:</strong> n√∫mero fixo de rodadas.</li>
        <li style="margin: 10px 0; border-left: 3px solid var(--warning); padding-left: 10px;"><strong>Duelo:</strong> 1x1 (melhor de 3 voc√™ pode adaptar).</li>
        <li style="margin: 10px 0; border-left: 3px solid var(--family-purple); padding-left: 10px;"><strong>Um Jogador:</strong> desafie o computador sozinho.</li>
        <li style="margin: 10px 0; border-left: 3px solid var(--family-blue); padding-left: 10px;"><strong>Times:</strong> crian√ßas vs adultos.</li>
        <li style="margin: 10px 0; border-left: 3px solid var(--danger); padding-left: 10px;"><strong>Survival:</strong> errou/tempo acabou, eliminou.</li>
        <li style="margin: 10px 0; border-left: 3px solid var(--family-blue); padding-left: 10px;"><strong>Coop:</strong> joguem juntos (regras podem ser ajustadas).</li>
      </ul>
    </div>

    <button class="btn btn-primary mt-30" onclick="closeModal('instructionsModal')">
      <i class="fas fa-thumbs-up"></i> ENTENDI, VAMOS JOGAR!
    </button>
  </div>
</div>

<div id="recordsModal" class="modal-overlay">
  <div class="modal-content">
    <h2 style="color: var(--warning); margin-bottom: 25px; text-align: center;">
      <i class="fas fa-trophy"></i> HALL DA FAMA DA FAM√çLIA
    </h2>
    <div id="hallOfFame"></div>
    <button class="btn btn-secondary mt-30" onclick="closeModal('recordsModal')">
      <i class="fas fa-times"></i> FECHAR
    </button>
  </div>
</div>

<script>
  // ============================================
  // CONFIGURA√á√ïES GLOBAIS
  // ============================================
  const GameConfig = {
    audioEnabled: false,
    voiceEnabled: false,
    speechRate: 1.5,
    version: '3.0.0'
  };

  const GameState = {
    mode: 'classic',
    difficulty: 'medium',
    players: [],
    scores: [],
    streaks: [],
    powerUps: [],
    isSinglePlayer: false,
    currentPlayer: 0,
    currentRound: 1,
    totalRounds: 10,
    gameActive: false,
    timer: 30,
    timerInterval: null,
    doublePoints: false,
    gamePaused: false,
    currentCorrectIndex: null,
    currentCategoryKey: null,
    currentPoints: null,
    questionStartAt: null,
    usedQuestions: new Set(),
    records: []
  };

  // ============================================
  // SISTEMA DE VOZ
  // ============================================
  const VoiceSystem = {
    isSpeaking: false,
    currentVoice: null,

    speak(text, type = 'normal') {
      if (!GameConfig.voiceEnabled || !('speechSynthesis' in window)) return;
      this.stop();

      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = 'pt-BR';
      utterance.rate = GameConfig.speechRate;
      utterance.volume = 1;

      switch(type) {
        case 'correct': utterance.rate = 1.2; utterance.pitch = 1.5; break;
        case 'wrong': utterance.rate = 0.9; utterance.pitch = 0.9; break;
        case 'excited': utterance.rate = 1.3; utterance.pitch = 1.9; break;
      }

      this.isSpeaking = true;
      this.currentVoice = utterance;
      utterance.onend = () => { this.isSpeaking = false; this.currentVoice = null; };
      window.speechSynthesis.speak(utterance);
    },

    stop() {
      if (this.isSpeaking) {
        window.speechSynthesis.cancel();
        this.isSpeaking = false;
        this.currentVoice = null;
      }
    }
  };

  // ============================================
  // SISTEMA DE SONS
  // ============================================
  const SoundSystem = {
    audioContext: null,
    initialized: false,

    init() {
      if (!this.audioContext && window.AudioContext) {
        this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
        this.initialized = true;
      }
    },

    playSound(type) {
      if (!GameConfig.audioEnabled || !this.initialized) return;

      try {
        if (this.audioContext.state === 'suspended') {
          this.audioContext.resume();
        }

        const oscillator = this.audioContext.createOscillator();
        const gainNode = this.audioContext.createGain();
        oscillator.connect(gainNode);
        gainNode.connect(this.audioContext.destination);

        switch(type) {
          case 'click':
            oscillator.frequency.setValueAtTime(800, this.audioContext.currentTime);
            gainNode.gain.setValueAtTime(0.2, this.audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + 0.1);
            oscillator.start();
            oscillator.stop(this.audioContext.currentTime + 0.1);
            break;

          case 'correct':
            oscillator.frequency.setValueAtTime(523.25, this.audioContext.currentTime);
            oscillator.frequency.setValueAtTime(659.25, this.audioContext.currentTime + 0.1);
            oscillator.frequency.setValueAtTime(783.99, this.audioContext.currentTime + 0.2);
            gainNode.gain.setValueAtTime(0.3, this.audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + 0.5);
            oscillator.start();
            oscillator.stop(this.audioContext.currentTime + 0.5);
            break;

          case 'wrong':
            oscillator.frequency.setValueAtTime(220, this.audioContext.currentTime);
            oscillator.frequency.setValueAtTime(196, this.audioContext.currentTime + 0.1);
            gainNode.gain.setValueAtTime(0.3, this.audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + 0.3);
            oscillator.start();
            oscillator.stop(this.audioContext.currentTime + 0.3);
            break;

          case 'timer':
            oscillator.frequency.setValueAtTime(600, this.audioContext.currentTime);
            gainNode.gain.setValueAtTime(0.2, this.audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + 0.2);
            oscillator.start();
            oscillator.stop(this.audioContext.currentTime + 0.2);
            break;
        }
      } catch (e) {
        console.log('Som n√£o dispon√≠vel');
      }
    }
  };

  // ============================================
  // BANCO DE DADOS DE PERGUNTAS
  // ============================================
  const QuestionsDB = {
    easy: [
      {q: 'üßÆ Quanto √© 7 + 8?', a: ['15', '16', '14', '13'], c: 0, cat: 'matematica', p: 5},
      {q: 'üßÆ Qual √© o dobro de 9?', a: ['18', '16', '20', '11'], c: 0, cat: 'matematica', p: 5},
      {q: 'üßÆ Quanto √© 12 - 5?', a: ['7', '8', '6', '9'], c: 0, cat: 'matematica', p: 5},
      {q: 'üßÆ Quanto √© 6 √ó 4?', a: ['24', '20', '28', '18'], c: 0, cat: 'matematica', p: 5},
      {q: 'üßÆ Quanto √© 18 √∑ 3?', a: ['6', '5', '9', '7'], c: 0, cat: 'matematica', p: 5},
      {q: 'üåé Qual √© a capital da Argentina?', a: ['Buenos Aires', 'Santiago', 'Lima', 'Montevid√©u'], c: 0, cat: 'geografia', p: 5},
      {q: 'üåé Em qual continente fica a China?', a: ['√Åsia', 'Am√©rica', 'Europa', '√Åfrica'], c: 0, cat: 'geografia', p: 5},
      {q: 'üèõÔ∏è Quem foi o primeiro presidente do Brasil?', a: ['Deodoro da Fonseca', 'Get√∫lio Vargas', 'Juscelino Kubitschek', 'Dom Pedro II'], c: 0, cat: 'historia', p: 5},
      {q: 'üèõÔ∏è Em que ano o homem foi √† Lua?', a: ['1969', '1959', '1979', '1989'], c: 0, cat: 'historia', p: 5},
      {q: 'üî¨ Quantos ossos tem o corpo humano?', a: ['206', '200', '210', '196'], c: 0, cat: 'ciencia', p: 5},
      {q: 'üî¨ Que planeta √© conhecido como gigante gasoso?', a: ['J√∫piter', 'Marte', 'Terra', 'V√™nus'], c: 0, cat: 'ciencia', p: 5},
      {q: 'üìö Qual o ant√¥nimo de "alto"?', a: ['Baixo', 'Grande', 'Largo', 'Comprido'], c: 0, cat: 'portugues', p: 5},
      {q: 'üé¨ Qual √© o filme do le√£ozinho da Disney?', a: ['O Rei Le√£o', 'Bambi', 'Mogli', 'Tarzan'], c: 0, cat: 'entretenimento', p: 5},
      {q: '‚öΩ Em que esporte se usa raquete?', a: ['T√™nis', 'Futebol', 'Basquete', 'V√¥lei'], c: 0, cat: 'esportes', p: 5},
      {q: 'ü§î Quantos minutos tem uma hora?', a: ['60', '50', '100', '30'], c: 0, cat: 'curiosidades', p: 5},
      {q: 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶ O pai do seu pai √© seu...?', a: ['Av√¥', 'Tio', 'Primo', 'Sobrinho'], c: 0, cat: 'familia', p: 5},
      {q: 'üé≠ O que tem no meio do ovo?', a: ['A letra V', 'A gema', 'O ar', 'Nada'], c: 0, cat: 'pegadinhas', p: 10}
    ],

    medium: [
      {q: 'üßÆ Qual √© a raiz quadrada de 81?', a: ['9', '8', '7', '10'], c: 0, cat: 'matematica', p: 10},
      {q: 'üßÆ Quanto √© 15% de 200?', a: ['30', '20', '25', '15'], c: 0, cat: 'matematica', p: 10},
      {q: 'üåé Qual √© o maior pa√≠s da Am√©rica do Sul?', a: ['Brasil', 'Argentina', 'Peru', 'Col√¥mbia'], c: 0, cat: 'geografia', p: 10},
      {q: 'üåé Qual √© a capital da R√∫ssia?', a: ['Moscou', 'S√£o Petersburgo', 'Kiev', 'Vars√≥via'], c: 0, cat: 'geografia', p: 10},
      {q: 'üèõÔ∏è Quem escreveu "Os Lus√≠adas"?', a: ['Lu√≠s de Cam√µes', 'Fernando Pessoa', 'Machado de Assis', 'Jos√© de Alencar'], c: 0, cat: 'historia', p: 10},
      {q: 'üèõÔ∏è Em que ano terminou a Segunda Guerra Mundial?', a: ['1945', '1939', '1941', '1943'], c: 0, cat: 'historia', p: 10},
      {q: 'üî¨ Qual √© o g√°s mais abundante na atmosfera?', a: ['Nitrog√™nio', 'Oxig√™nio', 'Carb√¥nico', 'Arg√¥nio'], c: 0, cat: 'ciencia', p: 10},
      {q: 'üî¨ Quem formulou a teoria da relatividade?', a: ['Albert Einstein', 'Isaac Newton', 'Stephen Hawking', 'Galileu Galilei'], c: 0, cat: 'ciencia', p: 10},
      {q: 'üìö Qual √© o plural de "cidad√£o"?', a: ['Cidad√£os', 'Cidad√£es', 'Cidad√µes', 'Cidad√µes'], c: 0, cat: 'portugues', p: 10},
      {q: 'üé¨ Quem dirigiu "Titanic"?', a: ['James Cameron', 'Steven Spielberg', 'George Lucas', 'Christopher Nolan'], c: 0, cat: 'entretenimento', p: 10},
      {q: '‚öΩ Quantas medalhas de ouro o Brasil tem em Olimp√≠adas?', a: ['37', '30', '40', '25'], c: 0, cat: 'esportes', p: 10},
      {q: 'ü§î Qual √© o ponto de ebuli√ß√£o da √°gua?', a: ['100¬∞C', '0¬∞C', '50¬∞C', '150¬∞C'], c: 0, cat: 'curiosidades', p: 10},
      {q: 'üé≠ Se uma pessoa nasceu em 2000, quantos anos tinha em 2020?', a: ['20', '19', '21', '18'], c: 0, cat: 'pegadinhas', p: 15},
      {q: 'üé≠ O que pesa mais: 1kg de ferro ou 1kg de algod√£o?', a: ['Pesam o mesmo', 'Ferro', 'Algod√£o', 'Depende'], c: 0, cat: 'pegadinhas', p: 15}
    ]
  };

  // ============================================
  // FUN√á√ïES DE UTILIDADE
  // ============================================
  function shuffleArray(array) {
    const newArray = [...array];
    for (let i = newArray.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
    }
    return newArray;
  }

  function shuffleQuestion(questionObj) {
    if (!questionObj || !questionObj.a || !Array.isArray(questionObj.a)) {
      return {
        q: 'Pergunta de emerg√™ncia - Quantos lados tem um quadrado?',
        a: ['4', '3', '5', '6'],
        c: 0,
        cat: 'matematica',
        p: 5
      };
    }

    const indices = [0, 1, 2, 3];
    for (let i = indices.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [indices[i], indices[j]] = [indices[j], indices[i]];
    }

    const newAnswers = indices.map(idx => questionObj.a[idx]);
    const newCorrectIndex = indices.indexOf(questionObj.c);

    return {
      ...questionObj,
      a: newAnswers,
      c: newCorrectIndex
    };
  }

  function getRandomQuestion(difficulty) {
    let questions = [];

    if (difficulty === 'mixed') {
      questions = [...QuestionsDB.easy, ...QuestionsDB.medium];
    } else if (QuestionsDB[difficulty]) {
      questions = QuestionsDB[difficulty];
    } else {
      questions = QuestionsDB.medium;
    }

    if (questions.length === 0) {
      return {
        q: 'Pergunta padr√£o - Qual √© a cor do c√©u em um dia claro?',
        a: ['Azul', 'Verde', 'Vermelho', 'Amarelo'],
        c: 0,
        cat: 'curiosidades',
        p: 5
      };
    }

    const randomIndex = Math.floor(Math.random() * questions.length);
    return shuffleQuestion(questions[randomIndex]);
  }

  function showNotification(message, type = 'info') {
    const notification = document.createElement('div');
    notification.style.cssText = `
      position: fixed;
      top: 100px;
      right: 20px;
      padding: 15px 25px;
      background: ${type === 'success' ? 'var(--success)' : 
                    type === 'error' ? 'var(--danger)' : 
                    type === 'warning' ? 'var(--warning)' : 'var(--info)'};
      color: white;
      border-radius: 12px;
      font-weight: bold;
      z-index: 10000;
      animation: slideIn 0.3s ease-out;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    `;
    
    notification.textContent = message;
    document.body.appendChild(notification);
    
    setTimeout(() => {
      notification.style.animation = 'slideOut 0.3s ease-out forwards';
      setTimeout(() => notification.remove(), 300);
    }, 3000);
  }

  function createConfetti() {
    const colors = ['#f59e0b', '#3b82f6', '#10b981', '#8b5cf6', '#ef4444'];
    for (let i = 0; i < 30; i++) {
      setTimeout(() => {
        const confetti = document.createElement('div');
        confetti.className = 'confetti';
        confetti.style.cssText = `
          width: ${Math.random() * 16 + 8}px;
          height: ${Math.random() * 16 + 8}px;
          background: ${colors[Math.floor(Math.random() * colors.length)]};
          top: -50px;
          left: ${Math.random() * 100}vw;
          border-radius: ${Math.random() > 0.5 ? '50%' : '0'};
          animation: confettiRain ${Math.random() * 3 + 2}s linear forwards;
          opacity: 0.9;
        `;
        document.body.appendChild(confetti);
        setTimeout(() => confetti.remove(), 5000);
      }, i * 20);
    }
  }

  // ============================================
  // FUN√á√ïES DO JOGO
  // ============================================
  function selectMode(modeKey) {
    GameState.mode = modeKey;
    GameState.isSinglePlayer = (modeKey === 'single');

    const cards = document.querySelectorAll('.mode-card');
    cards.forEach(c => c.classList.remove('selected'));

    cards.forEach(card => {
      const title = card.querySelector('h3').textContent.toLowerCase();
      const modeMap = {
        'classic': 'cl√°ssico',
        'quick': 'r√°pido',
        'duel': 'duelo',
        'single': 'um jogador',
        'teams': 'times',
        'survival': 'survival',
        'coop': 'cooperativo'
      };

      if (title.includes(modeMap[modeKey])) {
        card.classList.add('selected');
      }
    });
  }

  function setupPlayers() {
    SoundSystem.playSound('click');

    const numPlayers = parseInt(document.getElementById('numPlayers').value, 10);
    GameState.difficulty = document.getElementById('difficulty').value;

    const rounds = document.getElementById('rounds').value;
    GameState.totalRounds = rounds === 'infinite' ? 999 : parseInt(rounds, 10);

    if (GameState.isSinglePlayer && numPlayers === 1) {
      let playersHTML = `
        <div class="player-card">
          <span class="player-avatar">üë§</span>
          <input type="text" class="setting-input player-name-input"
                 placeholder="Seu nome"
                 value="Voc√™"
                 style="text-align: center; font-weight: bold;">
          <div style="margin-top: 10px; color: var(--info); font-weight: bold;">
            üéÆ Modo: 1 Jogador vs Computador
          </div>
        </div>
        <div class="player-card">
          <span class="player-avatar">ü§ñ</span>
          <div style="text-align: center; font-weight: bold; color: white; padding: 10px;">
            Computador (Oponente)
          </div>
          <div style="margin-top: 10px; color: var(--warning); font-weight: bold;">
            ‚öôÔ∏è N√≠vel: ${GameState.difficulty.toUpperCase()}
          </div>
        </div>
      `;

      document.getElementById('playersGrid').innerHTML = playersHTML;
    } else {
      let playersHTML = '';
      const avatars = ['üë®', 'üë©', 'üë¶', 'üëß', 'üë¥', 'üëµ', 'üßë', 'üßí'];
      const defaultNames = ['Papai', 'Mam√£e', 'Filho(a)', 'Vov√¥', 'Vov√≥', 'Tio(a)', 'Primo(a)', 'Amigo(a)'];

      for (let i = 0; i < numPlayers; i++) {
        playersHTML += `
          <div class="player-card">
            <span class="player-avatar">${avatars[i % avatars.length]}</span>
            <input type="text" class="setting-input player-name-input"
                   placeholder="Nome do Jogador ${i + 1}"
                   value="${defaultNames[i] || `Jogador ${i + 1}`}"
                   style="text-align: center; font-weight: bold;">
          </div>
        `;
      }

      document.getElementById('playersGrid').innerHTML = playersHTML;
    }

    document.getElementById('welcomeScreen').classList.add('hidden');
    document.getElementById('playerSetup').classList.remove('hidden');
  }

  function startGame() {
    SoundSystem.playSound('correct');

    GameState.players = [];
    GameState.scores = [];
    GameState.streaks = [];
    GameState.powerUps = [];

    if (GameState.isSinglePlayer) {
      GameState.players = ['Voc√™', 'Computador'];
      GameState.scores = [0, 0];
      GameState.streaks = [0, 0];
      GameState.powerUps = [
        { help: 2, time: 1, double: 1, skip: 1 },
        { help: 0, time: 0, double: 0, skip: 0 }
      ];
    } else {
      document.querySelectorAll('.player-name-input').forEach((input, index) => {
        const name = input.value.trim() || `Jogador ${index + 1}`;
        GameState.players.push(name);
        GameState.scores.push(0);
        GameState.streaks.push(0);
        GameState.powerUps.push({ help: 2, time: 1, double: 1, skip: 1 });
      });
    }

    GameState.currentPlayer = 0;
    GameState.currentRound = 1;
    GameState.gameActive = true;
    GameState.usedQuestions.clear();
    GameState.doublePoints = false;
    GameState.timer = 30;

    document.getElementById('playerSetup').classList.add('hidden');
    document.getElementById('gameScreen').classList.remove('hidden');
    document.getElementById('totalRounds').textContent = GameState.totalRounds;

    updateScoreboard();
    loadQuestion();
  }

  function loadQuestion() {
    if (!GameState.gameActive) return;

    const question = getRandomQuestion(GameState.difficulty);
    
    if (!question || !question.q || !question.a) {
      showNotification('‚ùå Erro ao carregar pergunta.', 'error');
      setTimeout(() => loadQuestion(), 1000);
      return;
    }

    GameState.currentCorrectIndex = question.c;
    GameState.currentCategoryKey = question.cat;
    GameState.currentPoints = question.p;

    const playerName = GameState.players[GameState.currentPlayer];
    document.getElementById('turnText').innerHTML = GameState.isSinglePlayer && GameState.currentPlayer === 1
      ? `üéÆ VEZ DO: <span style="color: var(--info);">COMPUTADOR ü§ñ</span>`
      : `üéÆ VEZ DE: <span style="color: var(--secondary);">${playerName.toUpperCase()}</span>`;

    document.getElementById('currentRound').textContent = GameState.currentRound;

    const categoryNames = {
      matematica: 'üßÆ MATEM√ÅTICA',
      geografia: 'üåé GEOGRAFIA',
      historia: 'üèõÔ∏è HIST√ìRIA',
      ciencia: 'üî¨ CI√äNCIA',
      portugues: 'üìö PORTUGU√äS',
      entretenimento: 'üé¨ ENTRETENIMENTO',
      esportes: '‚öΩ ESPORTES',
      curiosidades: 'ü§î CURIOSIDADES',
      familia: 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶ FAM√çLIA',
      pegadinhas: 'üé≠ PEGADINHAS'
    };

    document.getElementById('categoryDisplay').textContent = categoryNames[question.cat] || 'üéÆ GERAL';
    document.getElementById('questionDisplay').textContent = question.q;

    const answersContainer = document.getElementById('answersContainer');
    answersContainer.innerHTML = '';

    const letters = ['A', 'B', 'C', 'D'];
    question.a.forEach((option, index) => {
      const div = document.createElement('div');
      div.className = 'answer-option';
      div.innerHTML = `
        <span class="answer-letter">${letters[index]}</span>
        <span class="answer-content">${option}</span>
      `;
      div.onclick = () => checkAnswer(index);
      answersContainer.appendChild(div);
    });

    if (GameState.isSinglePlayer && GameState.currentPlayer === 1) {
      setTimeout(() => computerPlay(), 1500);
    }

    GameState.timer = 30;
    startTimer();
  }

  function computerPlay() {
    if (!GameState.gameActive) return;

    let correctChance = 0.7;
    switch(GameState.difficulty) {
      case 'easy': correctChance = 0.8; break;
      case 'medium': correctChance = 0.7; break;
      case 'hard': correctChance = 0.6; break;
      case 'expert': correctChance = 0.5; break;
    }

    setTimeout(() => {
      let selectedIndex;
      const correctIndex = GameState.currentCorrectIndex;

      if (Math.random() < correctChance) {
        selectedIndex = correctIndex;
      } else {
        const wrongOptions = [0, 1, 2, 3].filter(i => i !== correctIndex);
        selectedIndex = wrongOptions[Math.floor(Math.random() * wrongOptions.length)];
      }

      checkAnswer(selectedIndex);
    }, 2000);
  }

  function checkAnswer(selectedIndex) {
    if (!GameState.gameActive) return;

    clearInterval(GameState.timerInterval);

    const answers = document.querySelectorAll('.answer-option');
    answers.forEach(a => {
      a.onclick = null;
      a.style.cursor = 'default';
    });

    const correctIndex = GameState.currentCorrectIndex;
    const playerIndex = GameState.currentPlayer;
    const playerName = GameState.players[playerIndex];
    const isComputer = GameState.isSinglePlayer && playerIndex === 1;

    if (selectedIndex === correctIndex) {
      answers[selectedIndex].classList.add('correct');
      SoundSystem.playSound('correct');

      let points = GameState.currentPoints;
      if (GameState.doublePoints) points *= 2;

      GameState.scores[playerIndex] += points;
      GameState.streaks[playerIndex]++;

      showNotification(`${playerName} acertou! +${points} pontos!`, 'success');
      if (!isComputer) createConfetti();
    } else {
      answers[selectedIndex].classList.add('wrong');
      answers[correctIndex].classList.add('correct');
      SoundSystem.playSound('wrong');

      GameState.streaks[playerIndex] = 0;
      GameState.doublePoints = false;

      showNotification(`${playerName} errou!`, 'error');

      if (GameState.mode === 'survival') {
        GameState.scores[playerIndex] = -999;
        showNotification(`‚ùå ${playerName} ELIMINADO!`, 'error');
      }
    }

    setTimeout(nextTurn, 1500);
  }

  function nextTurn() {
    if (!GameState.gameActive) return;

    GameState.currentPlayer = (GameState.currentPlayer + 1) % GameState.players.length;

    if (GameState.mode === 'survival') {
      const alivePlayers = GameState.players.filter((_, i) => GameState.scores[i] > -999);
      if (alivePlayers.length <= 1) {
        endGame();
        return;
      }

      while (GameState.scores[GameState.currentPlayer] <= -999) {
        GameState.currentPlayer = (GameState.currentPlayer + 1) % GameState.players.length;
      }
    }

    if (GameState.currentPlayer === 0) {
      GameState.currentRound++;
      if (GameState.currentRound > GameState.totalRounds) {
        endGame();
        return;
      }
    }

    updateScoreboard();
    loadQuestion();
  }

  function startTimer() {
    clearInterval(GameState.timerInterval);

    const timerFill = document.getElementById('timerFill');
    const timerText = document.getElementById('timerText');

    timerFill.style.width = '100%';
    timerText.textContent = `TEMPO: ${GameState.timer}s`;

    GameState.timerInterval = setInterval(() => {
      if (!GameState.gameActive || GameState.gamePaused) return;

      GameState.timer--;
      const percentage = (GameState.timer / 30) * 100;

      timerFill.style.width = `${Math.max(0, percentage)}%`;
      timerText.textContent = `TEMPO: ${Math.max(0, GameState.timer)}s`;

      if (GameState.timer <= 10) {
        timerFill.style.background = 'linear-gradient(90deg, var(--danger), #f87171)';
        timerText.style.color = 'var(--danger)';
        SoundSystem.playSound('timer');
      }

      if (GameState.timer <= 0) {
        timeUp();
      }
    }, 1000);
  }

  function timeUp() {
    clearInterval(GameState.timerInterval);
    SoundSystem.playSound('wrong');

    const playerName = GameState.players[GameState.currentPlayer];
    showNotification(`‚è∞ TEMPO ESGOTADO! ${playerName} perdeu a vez.`, 'warning');

    if (GameState.mode === 'survival') {
      GameState.scores[GameState.currentPlayer] = -999;
      showNotification(`‚ùå ${playerName} ELIMINADO por tempo!`, 'error');
    }

    setTimeout(nextTurn, 1000);
  }

  function updateScoreboard() {
    const scoreList = document.getElementById('scoreList');

    const playerData = GameState.players.map((player, index) => ({
      name: player,
      score: GameState.scores[index],
      streak: GameState.streaks[index],
      isCurrent: index === GameState.currentPlayer,
      eliminated: GameState.scores[index] <= -999,
      isComputer: GameState.isSinglePlayer && index === 1
    }));

    playerData.sort((a, b) => {
      if (a.eliminated && !b.eliminated) return 1;
      if (!a.eliminated && b.eliminated) return -1;
      return b.score - a.score;
    });

    scoreList.innerHTML = playerData.map((player, rank) => {
      const medal = rank === 0 ? 'ü•á' : rank === 1 ? 'ü•à' : rank === 2 ? 'ü•â' : 'üîπ';
      const streakBadge = player.streak >= 3 ? ` üî•${player.streak}` : '';
      const currentBadge = player.isCurrent ? ' üéÆ' : '';
      const computerBadge = player.isComputer ? ' ü§ñ' : '';

      return `
        <div class="score-item ${player.isCurrent ? 'current' : ''}" style="${player.eliminated ? 'opacity:0.5;text-decoration:line-through;' : ''}">
          <div class="score-player">
            ${medal} ${player.name}${computerBadge}${streakBadge}${currentBadge}
          </div>
          <div class="score-points">
            ${player.eliminated ? '‚ùå ELIMINADO' : `${player.score} pts`}
          </div>
        </div>
      `;
    }).join('');
  }

  function usePowerUp(type) {
    SoundSystem.playSound('correct');

    const playerIndex = GameState.currentPlayer;
    const powerUps = GameState.powerUps[playerIndex];

    if (!powerUps || powerUps[type] <= 0) {
      showNotification('‚ùå Power-up n√£o dispon√≠vel!', 'error');
      return;
    }

    powerUps[type]--;
    const playerName = GameState.players[playerIndex];

    switch(type) {
      case 'help':
        const answers = document.querySelectorAll('.answer-option');
        const correctIndex = GameState.currentCorrectIndex;
        const wrongAnswers = Array.from(answers).filter((_, idx) => idx !== correctIndex);
        shuffleArray(wrongAnswers);

        wrongAnswers.slice(0, 2).forEach(el => {
          el.style.opacity = '0.3';
          el.style.pointerEvents = 'none';
          el.style.textDecoration = 'line-through';
        });

        showNotification(`‚ùì ${playerName} usou AJUDA DA FAM√çLIA!`, 'info');
        break;

      case 'time':
        GameState.timer += 15;
        showNotification(`‚è±Ô∏è ${playerName} ganhou 15 SEGUNDOS EXTRAS!`, 'success');
        break;

      case 'double':
        GameState.doublePoints = true;
        showNotification(`üíé ${playerName} ativou DUPLA PONTUA√á√ÉO!`, 'success');
        break;

      case 'skip':
        showNotification(`‚è≠Ô∏è ${playerName} PULOU a pergunta!`, 'warning');
        clearInterval(GameState.timerInterval);
        setTimeout(nextTurn, 600);
        break;
    }
  }

  function pauseGame() {
    SoundSystem.playSound('click');
    GameState.gamePaused = !GameState.gamePaused;

    if (GameState.gamePaused) {
      showNotification('‚è∏Ô∏è JOGO PAUSADO', 'warning');
      clearInterval(GameState.timerInterval);
    } else {
      showNotification('‚ñ∂Ô∏è JOGO RETOMADO', 'success');
      startTimer();
    }
  }

  function showHint() {
    SoundSystem.playSound('click');
    const playerIndex = GameState.currentPlayer;

    if (GameState.scores[playerIndex] >= 3) {
      GameState.scores[playerIndex] -= 3;
      showNotification('üí° Dica usada! -3 pontos', 'info');
      updateScoreboard();
    } else {
      showNotification('‚ùå Pontos insuficientes para dica!', 'error');
    }
  }

  function endGame() {
    GameState.gameActive = false;
    clearInterval(GameState.timerInterval);
    SoundSystem.playSound('correct');

    const maxScore = Math.max(...GameState.scores);
    const winners = GameState.players.filter((_, i) => GameState.scores[i] === maxScore && GameState.scores[i] > -999);

    if (winners.length === 1 && !(GameState.isSinglePlayer && winners[0] === 'Computador')) {
      saveRecord(maxScore, winners[0], GameState.mode, GameState.difficulty);
    }

    document.getElementById('gameScreen').classList.add('hidden');
    document.getElementById('resultsScreen').classList.remove('hidden');

    const winnerCrown = document.getElementById('winnerCrown');
    const winnerTitle = document.getElementById('winnerTitle');
    const winnerScore = document.getElementById('winnerScore');

    if (winners.length === 1) {
      winnerCrown.textContent = 'üëë';
      winnerTitle.innerHTML = GameState.isSinglePlayer && winners[0] === 'Computador'
        ? `üèÜ VENCEDOR: <span style="color: var(--info);">COMPUTADOR ü§ñ</span> üèÜ`
        : `üèÜ CAMPE√ÉO: <span style="color: var(--warning);">${winners[0].toUpperCase()}</span> üèÜ`;
      winnerScore.textContent = `Com ${maxScore} pontos!`;
    } else if (winners.length > 1) {
      winnerCrown.textContent = 'üëëüëë';
      winnerTitle.innerHTML = `üèÜ EMPATE: <span style="color: var(--warning);">${winners.join(' e ').toUpperCase()}</span> üèÜ`;
      winnerScore.textContent = `Com ${maxScore} pontos cada!`;
    } else {
      winnerCrown.textContent = 'üò¢';
      winnerTitle.textContent = 'üéÆ FIM DE JOGO';
      winnerScore.textContent = 'Todos foram eliminados!';
    }

    createConfetti();
    showGameStats();
  }

  function showGameStats() {
    const gameStats = document.getElementById('gameStats');
    const totalRounds = Math.max(0, GameState.currentRound - 1);

    gameStats.innerHTML = `
      <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px;">
        <div style="background: rgba(30,41,59,0.7); padding:20px; border-radius:15px;">
          <h4 style="color: var(--info); margin-bottom:10px;"><i class="fas fa-chart-line"></i> DESEMPENHO</h4>
          <p><strong>Rodadas Jogadas:</strong> ${totalRounds}</p>
          <p><strong>Jogadores:</strong> ${GameState.players.length}</p>
          <p><strong>Modo:</strong> ${GameState.mode.toUpperCase()}</p>
        </div>

        <div style="background: rgba(30,41,59,0.7); padding:20px; border-radius:15px;">
          <h4 style="color: var(--info); margin-bottom:10px;"><i class="fas fa-gamepad"></i> JOGO</h4>
          <p><strong>Dificuldade:</strong> ${GameState.difficulty.toUpperCase()}</p>
          <p><strong>Rodadas Totais:</strong> ${GameState.totalRounds}</p>
        </div>
      </div>
    `;
  }

  function saveRecord(score, player, mode, difficulty) {
    const record = {
      score,
      player,
      mode: GameState.isSinglePlayer ? 'single' : mode,
      difficulty,
      date: new Date().toLocaleDateString('pt-BR')
    };

    GameState.records.push(record);
    GameState.records.sort((a, b) => b.score - a.score);
    if (GameState.records.length > 10) GameState.records.length = 10;

    localStorage.setItem('familyShowRecords', JSON.stringify(GameState.records));
  }

  function backToMenu() {
    SoundSystem.playSound('click');
    GameState.gameActive = false;
    clearInterval(GameState.timerInterval);
    VoiceSystem.stop();

    document.getElementById('playerSetup').classList.add('hidden');
    document.getElementById('gameScreen').classList.add('hidden');
    document.getElementById('resultsScreen').classList.add('hidden');
    document.getElementById('welcomeScreen').classList.remove('hidden');
  }

  function rematch() {
    SoundSystem.playSound('correct');

    GameState.scores = GameState.scores.map(() => 0);
    GameState.streaks = GameState.streaks.map(() => 0);
    GameState.powerUps = GameState.powerUps.map((p, i) =>
      (GameState.isSinglePlayer && i === 1) ? p : { help: 2, time: 1, double: 1, skip: 1 }
    );

    GameState.currentPlayer = 0;
    GameState.currentRound = 1;
    GameState.gameActive = true;
    GameState.usedQuestions.clear();
    GameState.doublePoints = false;
    GameState.timer = 30;

    document.getElementById('resultsScreen').classList.add('hidden');
    document.getElementById('gameScreen').classList.remove('hidden');

    updateScoreboard();
    setTimeout(loadQuestion, 1000);
  }

  function newGame() {
    backToMenu();
  }

  function showRecords() {
    SoundSystem.playSound('click');
    const hallOfFame = document.getElementById('hallOfFame');
    const records = GameState.records || [];

    if (records.length === 0) {
      hallOfFame.innerHTML = '<p style="text-align:center; padding:40px; color: var(--warning);">Nenhum recorde ainda!</p>';
    } else {
      hallOfFame.innerHTML = `
        <div class="scores-list">
          ${records.map((r, i) => {
            const medal = i === 0 ? 'ü•á' : i === 1 ? 'ü•à' : i === 2 ? 'ü•â' : `${i + 1}.`;
            const modeText = r.mode === 'single' ? '1 Jogador' : r.mode;
            return `
              <div class="score-item" style="margin-bottom:10px;">
                <div class="score-player">${medal} ${r.player}
                  <small style="color:#94a3b8; font-size:0.9rem;">(${modeText} - ${r.difficulty})</small>
                </div>
                <div class="score-points">${r.score} pts</div>
                <div style="font-size:0.8rem; color:#64748b;">${r.date}</div>
              </div>
            `;
          }).join('')}
        </div>
      `;
    }

    document.getElementById('recordsModal').style.display = 'flex';
  }

  function showQuickStats() {
    SoundSystem.playSound('click');
    const statsList = document.getElementById('statsList');
    const quickStats = document.getElementById('quickStats');
    const records = GameState.records || [];

    if (records.length === 0) {
      quickStats.style.display = 'none';
      return;
    }

    quickStats.style.display = 'block';
    const top3 = records.slice(0, 3);

    statsList.innerHTML = top3.map((r, i) => {
      const medal = ['ü•á', 'ü•à', 'ü•â'][i];
      const modeText = r.mode === 'single' ? '1 Jogador' : r.mode;
      return `
        <div style="display:flex;justify-content:space-between;align-items:center;padding:15px;margin:10px 0;background:rgba(30,41,59,0.7);border-radius:12px;">
          <div><strong>${medal} ${r.player}</strong><br><small>${modeText} ‚Ä¢ ${r.date}</small></div>
          <div style="font-size:1.5rem;font-weight:bold;color:var(--warning);">${r.score}</div>
        </div>
      `;
    }).join('');
  }

  function showInstructions() {
    SoundSystem.playSound('click');
    document.getElementById('instructionsModal').style.display = 'flex';
  }

  function closeModal(modalId) {
    SoundSystem.playSound('click');
    document.getElementById(modalId).style.display = 'none';
  }

  function confirmQuit() {
    if (confirm('Tem certeza que deseja sair? O progresso ser√° perdido.')) {
      backToMenu();
    }
  }

  function shareResults() {
    SoundSystem.playSound('click');
    const maxScore = Math.max(...GameState.scores);
    const winner = GameState.players[GameState.scores.indexOf(maxScore)] || 'Todos';
    const shareText = `üéÆ SHOW DA FAM√çLIA! ${winner} venceu com ${maxScore} pontos!`;

    if (navigator.share) {
      navigator.share({ title: 'Show da Fam√≠lia', text: shareText });
    } else {
      navigator.clipboard.writeText(shareText)
        .then(() => showNotification('üìã Copiado para a √°rea de transfer√™ncia!', 'success'))
        .catch(() => showNotification('‚ùå N√£o foi poss√≠vel copiar', 'error'));
    }
  }

  function toggleAudio() {
    SoundSystem.init();
    GameConfig.audioEnabled = !GameConfig.audioEnabled;
    const audioBtn = document.getElementById('audioToggle');

    if (GameConfig.audioEnabled) {
      audioBtn.innerHTML = '<i class="fas fa-volume-up"></i>';
      audioBtn.style.background = 'rgba(16, 185, 129, 0.9)';
      audioBtn.title = 'Som ligado';
    } else {
      audioBtn.innerHTML = '<i class="fas fa-volume-mute"></i>';
      audioBtn.style.background = 'rgba(15, 23, 42, 0.9)';
      audioBtn.title = 'Som desligado';
    }
  }

  function toggleVoice() {
    GameConfig.voiceEnabled = !GameConfig.voiceEnabled;
    const voiceBtn = document.getElementById('voiceToggle');

    if (GameConfig.voiceEnabled) {
      voiceBtn.innerHTML = '<i class="fas fa-microphone-alt"></i>';
      voiceBtn.style.background = 'rgba(16, 185, 129, 0.9)';
      voiceBtn.title = 'Voz ligada';
    } else {
      voiceBtn.innerHTML = '<i class="fas fa-microphone-alt-slash"></i>';
      voiceBtn.style.background = 'rgba(15, 23, 42, 0.9)';
      voiceBtn.title = 'Voz desligada';
      VoiceSystem.stop();
    }
  }

  // ============================================
  // INICIALIZA√á√ÉO
  // ============================================
  document.addEventListener('DOMContentLoaded', () => {
    document.getElementById('audioToggle').addEventListener('click', toggleAudio);
    document.getElementById('voiceToggle').addEventListener('click', toggleVoice);

    document.getElementById('numPlayers').addEventListener('input', function() {
      const count = parseInt(this.value);
      const text = count === 1 ? '1 JOGADOR (Vs Computador)' : `${count} JOGADORES`;
      document.getElementById('playerCount').textContent = text;
    });

    document.querySelectorAll('.modal-overlay').forEach(modal => {
      modal.addEventListener('click', function(e) {
        if (e.target === this) {
          this.style.display = 'none';
        }
      });
    });

    GameState.records = JSON.parse(localStorage.getItem('familyShowRecords') || '[]');
    selectMode('classic');
  });
</script>
</body>
</html>
