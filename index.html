<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üéÆ SHOW DA FAM√çLIA - Edi√ß√£o Definitiva üèÜ</title>
  <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&family=Nunito:wght@400;700;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    :root {
      --primary: #4f46e5;
      --secondary: #f59e0b;
      --success: #10b981;
      --danger: #ef4444;
      --warning: #f59e0b;
      --info: #3b82f6;
      --dark: #0f172a;
      --light: #f8fafc;
      --gray-700: #374151;
      --gray-800: #1f2937;
      --family-red: #ef4444;
      --family-blue: #3b82f6;
      --family-yellow: #f59e0b;
      --family-green: #10b981;
      --family-purple: #8b5cf6;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      background: linear-gradient(135deg, #0f172a 0%, #1e40af 100%);
      color: var(--light);
      font-family: 'Nunito', system-ui, sans-serif;
      min-height: 100vh;
      padding: 20px;
      overflow-x: hidden;
    }

    #app { max-width: 1400px; margin: 0 auto; padding: 20px; }

    .main-card {
      background: rgba(15, 23, 42, 0.95);
      border-radius: 24px;
      padding: 30px;
      box-shadow: 0 10px 40px rgba(79, 70, 229, 0.3), 0 0 60px rgba(245, 158, 11, 0.1);
      border: 3px solid rgba(79, 70, 229, 0.3);
      backdrop-filter: blur(10px);
      position: relative;
      overflow: hidden;
    }

    .game-header {
      text-align: center;
      margin-bottom: 40px;
      padding: 25px;
      background: linear-gradient(90deg,
        var(--family-red),
        var(--family-yellow),
        var(--family-green),
        var(--family-blue),
        var(--family-purple));
      border-radius: 20px;
      position: relative;
      overflow: hidden;
      animation: headerGlow 3s infinite alternate;
    }

    .game-header h1 {
      font-family: 'Comic Neue', cursive;
      font-size: 4rem;
      color: white;
      text-shadow: 0 2px 4px rgba(0,0,0,0.3), 0 0 30px rgba(255, 255, 255, 0.5);
      margin-bottom: 10px;
      animation: textGlow 2s ease-in-out infinite alternate;
    }

    .game-subtitle {
      font-size: 1.3rem;
      opacity: 0.95;
      color: white;
      font-weight: 600;
    }

    @keyframes headerGlow {
      0% { box-shadow: 0 0 20px var(--family-red); }
      25% { box-shadow: 0 0 20px var(--family-yellow); }
      50% { box-shadow: 0 0 20px var(--family-green); }
      75% { box-shadow: 0 0 20px var(--family-blue); }
      100% { box-shadow: 0 0 20px var(--family-purple); }
    }

    @keyframes textGlow {
      from { text-shadow: 0 0 20px rgba(255, 255, 255, 0.5); }
      to { text-shadow: 0 0 30px rgba(255, 255, 255, 0.8), 0 0 40px rgba(245, 158, 11, 0.6); }
    }

    @keyframes pulse { 0%{transform:scale(1)} 50%{transform:scale(1.05)} 100%{transform:scale(1)} }
    @keyframes bounce { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-10px)} }
    @keyframes confettiRain { 0%{transform:translateY(-100vh) rotate(0deg)} 100%{transform:translateY(100vh) rotate(360deg)} }

    .btn {
      padding: 18px 28px;
      border: none;
      border-radius: 16px;
      font-size: 1.1rem;
      font-weight: 800;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      margin: 12px 0;
      width: 100%;
      font-family: 'Comic Neue', cursive;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .btn:hover {
      transform: translateY(-5px) scale(1.05);
      box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
    }

    .btn-primary { background: linear-gradient(135deg, var(--primary), #6366f1); color: white; }
    .btn-secondary { background: linear-gradient(135deg, var(--secondary), #fbbf24); color: white; }
    .btn-success { background: linear-gradient(135deg, var(--success), #34d399); color: white; }
    .btn-danger { background: linear-gradient(135deg, var(--danger), #f87171); color: white; }
    .btn-warning { background: linear-gradient(135deg, var(--warning), #fbbf24); color: white; }
    .btn-family { background: linear-gradient(135deg, var(--family-red), var(--family-yellow)); color: white; animation: pulse 2s infinite; }

    .top-controls {
      position: fixed;
      top: 20px;
      right: 20px;
      display: flex;
      gap: 10px;
      z-index: 100;
    }

    .control-btn {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      border: none;
      background: rgba(15, 23, 42, 0.9);
      color: white;
      font-size: 1.2rem;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .control-btn:hover { transform: scale(1.1); background: rgba(79, 70, 229, 0.9); }

    .mode-selection {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 25px;
      margin: 30px 0;
    }

    .mode-card {
      background: rgba(30, 41, 59, 0.8);
      border-radius: 20px;
      padding: 25px;
      border: 2px solid transparent;
      transition: all 0.3s;
      text-align: center;
      cursor: pointer;
    }

    .mode-card:hover {
      border-color: var(--secondary);
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(245, 158, 11, 0.2);
    }

    .mode-card.selected { border-color: var(--success); background: rgba(16, 185, 129, 0.1); }

    .mode-icon { font-size: 3rem; margin-bottom: 15px; }

    .settings-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 25px;
      margin: 30px 0;
    }

    .setting-group { margin-bottom: 25px; }
    .setting-label { display: block; margin-bottom: 10px; font-size: 1.2rem; color: #cbd5e1; font-weight: 700; }

    .setting-input {
      width: 100%;
      padding: 18px 22px;
      border: 2px solid #334155;
      border-radius: 14px;
      font-size: 1.1rem;
      background: rgba(30, 41, 59, 0.9);
      color: white;
      transition: all 0.3s;
    }

    .setting-input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 4px rgba(79, 70, 229, 0.2);
    }

    .slider-value { text-align: center; font-size: 1.8rem; color: var(--secondary); font-weight: 900; margin-top: 10px; }

    .players-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px;
      margin: 30px 0;
    }

    .player-card {
      background: rgba(30, 41, 59, 0.9);
      border-radius: 18px;
      padding: 20px;
      text-align: center;
      border: 3px solid transparent;
      transition: all 0.3s;
      position: relative;
    }

    .player-card.current {
      border-color: var(--secondary);
      box-shadow: 0 0 30px rgba(245, 158, 11, 0.4);
      animation: pulse 2s infinite;
    }

    .player-avatar { font-size: 3.5rem; margin-bottom: 15px; display: block; animation: bounce 2s infinite; }

    .game-area {
      background: rgba(30, 41, 59, 0.95);
      border-radius: 24px;
      padding: 30px;
      margin: 30px 0;
      border-left: 8px solid var(--primary);
    }

    .turn-info { text-align: center; margin-bottom: 25px; padding: 15px; background: rgba(79, 70, 229, 0.2); border-radius: 15px; }
    .turn-text { font-size: 1.8rem; color: var(--secondary); font-weight: 900; }

    .category-badge {
      display: inline-block;
      padding: 10px 20px;
      background: rgba(79, 70, 229, 0.2);
      border-radius: 25px;
      font-size: 1rem;
      font-weight: 700;
      margin: 15px 0;
      color: #818cf8;
    }

    .question-container {
      min-height: 200px;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 30px;
      margin: 30px 0;
      background: rgba(15, 23, 42, 0.7);
      border-radius: 20px;
      border: 3px solid var(--primary);
    }

    .question-text { font-size: 2.2rem; line-height: 1.5; color: white; font-weight: 700; text-align: center; }

    .answers-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin: 30px 0;
    }

    .answer-option {
      padding: 25px;
      background: rgba(51, 65, 85, 0.9);
      border: 3px solid transparent;
      border-radius: 18px;
      color: white;
      font-size: 1.2rem;
      cursor: pointer;
      transition: all 0.3s;
      position: relative;
      overflow: hidden;
    }

    .answer-option:hover { background: rgba(71, 85, 105, 0.95); transform: translateX(10px); border-color: var(--info); }
    .answer-option.correct { background: linear-gradient(135deg, var(--success), #34d399); border-color: var(--success); animation: pulse 0.5s; }
    .answer-option.wrong { background: linear-gradient(135deg, var(--danger), #f87171); border-color: var(--danger); }

    .answer-letter { position: absolute; left: 20px; font-weight: 900; color: rgba(255, 255, 255, 0.3); font-size: 1.5rem; }
    .answer-content { margin-left: 50px; }

    .timer-container { margin: 25px 0; }
    .timer-bar { height: 15px; background: rgba(71, 85, 105, 0.5); border-radius: 10px; overflow: hidden; margin-bottom: 10px; }
    .timer-fill { height: 100%; background: linear-gradient(90deg, var(--success), var(--warning), var(--danger)); width: 100%; transition: width 1s linear; border-radius: 10px; }
    .timer-text { text-align: center; font-size: 1.3rem; color: var(--warning); font-weight: 700; }

    .powerups-container { display: flex; justify-content: center; gap: 20px; margin: 30px 0; flex-wrap: wrap; }

    .powerup-btn {
      padding: 15px 25px;
      background: rgba(139, 92, 246, 0.9);
      border: none;
      border-radius: 15px;
      color: white;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .powerup-btn:hover { transform: scale(1.1); background: rgba(139, 92, 246, 1); }
    .powerup-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

    .scoreboard {
      background: rgba(15, 23, 42, 0.95);
      border-radius: 20px;
      padding: 25px;
      margin: 30px 0;
      border: 3px solid rgba(79, 70, 229, 0.3);
    }

    .scoreboard-title { text-align: center; font-size: 2rem; margin-bottom: 25px; color: var(--secondary); font-weight: 900; }
    .scores-list { display: grid; gap: 15px; }

    .score-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px;
      background: rgba(30, 41, 59, 0.7);
      border-radius: 15px;
      transition: all 0.3s;
      border-left: 5px solid transparent;
      gap: 10px;
    }

    .score-item.current { background: rgba(79, 70, 229, 0.2); border-left-color: var(--primary); }

    .score-player { font-weight: 800; font-size: 1.3rem; display: flex; align-items: center; gap: 10px; flex-wrap: wrap; }
    .score-points { font-weight: 900; font-size: 1.8rem; color: var(--secondary); }

    .results-screen { text-align: center; padding: 40px; }
    .winner-crown { font-size: 5rem; margin-bottom: 20px; animation: bounce 2s infinite; }
    .winner-title { font-size: 3rem; color: var(--secondary); margin-bottom: 20px; }
    .winner-score { font-size: 2.5rem; color: var(--warning); margin-bottom: 30px; }

    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      z-index: 2000;
      align-items: center;
      justify-content: center;
      backdrop-filter: blur(5px);
    }

    .modal-content {
      background: var(--dark);
      border-radius: 30px;
      padding: 40px;
      max-width: 800px;
      width: 90%;
      max-height: 90vh;
      overflow-y: auto;
      border: 4px solid var(--secondary);
      animation: modalSlide 0.4s ease-out;
    }

    @keyframes modalSlide {
      from { opacity: 0; transform: translateY(-60px) scale(0.9); }
      to { opacity: 1; transform: translateY(0) scale(1); }
    }

    .confetti { position: fixed; width: 15px; height: 15px; pointer-events: none; z-index: 10000; animation: confettiRain 5s linear forwards; }

    .hidden { display: none !important; }
    .text-center { text-align: center; }
    .mt-20 { margin-top: 20px; }
    .mt-30 { margin-top: 30px; }
    .mb-20 { margin-bottom: 20px; }
    .mb-30 { margin-bottom: 30px; }

    @media (max-width: 1200px) {
      .game-header h1 { font-size: 3rem; }
      .answers-container { grid-template-columns: repeat(2, 1fr); }
    }

    @media (max-width: 768px) {
      .game-header h1 { font-size: 2.5rem; }
      .answers-container { grid-template-columns: 1fr; }
      .question-text { font-size: 1.8rem; }
      .mode-selection { grid-template-columns: 1fr; }
      .settings-grid { grid-template-columns: 1fr; }
      .players-grid { grid-template-columns: 1fr; }
      .powerups-container { flex-direction: column; align-items: center; }
      .top-controls { top: 10px; right: 10px; }
      .control-btn { width: 40px; height: 40px; font-size: 1rem; }
    }

    @media (max-width: 480px) {
      .game-header h1 { font-size: 2rem; }
      .btn { padding: 15px 20px; font-size: 1rem; }
      .modal-content { padding: 20px; }
      .winner-title { font-size: 2rem; }
    }
  </style>
</head>

<body>
<div id="app">
  <div class="main-card">

    <div class="top-controls">
      <button class="control-btn" id="audioToggle" title="Alternar som">
        <i class="fas fa-volume-up"></i>
      </button>
      <button class="control-btn" onclick="showInstructions()" title="Instru√ß√µes">
        <i class="fas fa-question"></i>
      </button>
      <button class="control-btn" onclick="showRecords()" title="Recordes">
        <i class="fas fa-trophy"></i>
      </button>
    </div>

    <header class="game-header">
      <h1>üéÆ SHOW DA FAM√çLIA üéÆ</h1>
      <p class="game-subtitle">O jogo mais completo para toda a fam√≠lia!</p>
    </header>

    <div id="welcomeScreen">
      <div class="text-center mb-30">
        <h2 style="font-size: 2.5rem; color: var(--secondary); margin-bottom: 20px;">
          <i class="fas fa-users"></i> BEM-VINDO, FAM√çLIA!
        </h2>
        <p style="font-size: 1.3rem; color: #cbd5e1; max-width: 800px; margin: 0 auto 30px;">
          Escolha o modo de jogo e prepare-se para horas de divers√£o, aprendizado e muitas risadas!
        </p>
      </div>

      <div class="setting-group">
        <label class="setting-label"><i class="fas fa-gamepad"></i> ESCOLHA O MODO DE JOGO</label>
        <div class="mode-selection">
          <div class="mode-card" onclick="selectMode('classic')">
            <div class="mode-icon">üèÜ</div>
            <h3>CL√ÅSSICO</h3>
            <p>Todos contra todos, rodadas infinitas</p>
          </div>
          <div class="mode-card" onclick="selectMode('quick')">
            <div class="mode-icon">‚ö°</div>
            <h3>R√ÅPIDO</h3>
            <p>5, 10 ou 15 rodadas por jogador</p>
          </div>
          <div class="mode-card" onclick="selectMode('duel')">
            <div class="mode-icon">‚öîÔ∏è</div>
            <h3>DUELO X1</h3>
            <p>Batalha cara a cara, melhor de 3</p>
          </div>
          <div class="mode-card" onclick="selectMode('teams')">
            <div class="mode-icon">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</div>
            <h3>TIMES</h3>
            <p>Crian√ßas vs Adultos ou times mistos</p>
          </div>
          <div class="mode-card" onclick="selectMode('survival')">
            <div class="mode-icon">üî•</div>
            <h3>SURVIVAL</h3>
            <p>Errou, sai! √öltimo sobrevivente ganha</p>
          </div>
          <div class="mode-card" onclick="selectMode('coop')">
            <div class="mode-icon">ü§ù</div>
            <h3>COOPERATIVO</h3>
            <p>Todos juntos contra o tempo</p>
          </div>
        </div>
      </div>

      <div class="settings-grid">
        <div class="setting-group">
          <label class="setting-label"><i class="fas fa-user-friends"></i> QUANTOS JOGADORES?</label>
          <input type="range" id="numPlayers" min="2" max="8" value="4" class="setting-input">
          <div class="slider-value" id="playerCount">4 JOGADORES</div>
        </div>

        <div class="setting-group">
          <label class="setting-label"><i class="fas fa-brain"></i> N√çVEL DE DIFICULDADE</label>
          <select id="difficulty" class="setting-input">
            <option value="easy">ü•á F√ÅCIL (Para todos)</option>
            <option value="medium" selected>ü•à M√âDIO (Fam√≠lia)</option>
            <option value="hard">ü•á DIF√çCIL (Experts)</option>
            <option value="expert">üëë EXPERT (Desafio Total)</option>
            <option value="mixed">üé≤ MISTURADO (Todos os n√≠veis)</option>
          </select>
        </div>

        <div class="setting-group">
          <label class="setting-label"><i class="fas fa-flag-checkered"></i> QUANTAS RODADAS?</label>
          <select id="rounds" class="setting-input">
            <option value="5">5 Rodadas (R√°pido)</option>
            <option value="10" selected>10 Rodadas (Normal)</option>
            <option value="15">15 Rodadas (Longo)</option>
            <option value="20">20 Rodadas (Maratona)</option>
            <option value="infinite">Infinitas (At√© cansar!)</option>
          </select>
        </div>
      </div>

      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 40px;">
        <button class="btn btn-family" onclick="setupPlayers()">
          <i class="fas fa-play-circle"></i> COME√áAR JOGO
        </button>
        <button class="btn btn-secondary" onclick="showQuickStats()">
          <i class="fas fa-chart-line"></i> ESTAT√çSTICAS
        </button>
      </div>

      <div id="quickStats" class="scoreboard mt-30" style="display: none;">
        <h3 class="scoreboard-title"><i class="fas fa-chart-pie"></i> ESTAT√çSTICAS DA FAM√çLIA</h3>
        <div id="statsList"></div>
      </div>
    </div>

    <div id="playerSetup" class="hidden">
      <h2 style="color: var(--secondary); margin-bottom: 30px; text-align: center;">
        <i class="fas fa-user-edit"></i> CONFIGURE OS JOGADORES
      </h2>

      <div class="players-grid" id="playersGrid"></div>

      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 40px;">
        <button class="btn btn-success" onclick="startGame()">
          <i class="fas fa-rocket"></i> INICIAR PARTIDA!
        </button>
        <button class="btn btn-secondary" onclick="backToMenu()">
          <i class="fas fa-arrow-left"></i> VOLTAR
        </button>
      </div>
    </div>

    <div id="gameScreen" class="hidden">
      <div class="turn-info">
        <div id="turnText" class="turn-text"></div>
        <div id="categoryDisplay" class="category-badge"></div>
      </div>

      <div class="timer-container">
        <div class="timer-bar">
          <div id="timerFill" class="timer-fill"></div>
        </div>
        <div id="timerText" class="timer-text">TEMPO: 30s</div>
      </div>

      <div class="game-area">
        <div class="question-container">
          <div id="questionDisplay" class="question-text"></div>
        </div>

        <div id="answersContainer" class="answers-container"></div>

        <div class="powerups-container">
          <button class="powerup-btn" onclick="usePowerUp('help')" id="helpBtn">
            <i class="fas fa-life-ring"></i> AJUDA DA FAM√çLIA (2)
          </button>
          <button class="powerup-btn" onclick="usePowerUp('time')" id="timeBtn">
            <i class="fas fa-clock"></i> TEMPO EXTRA (1)
          </button>
          <button class="powerup-btn" onclick="usePowerUp('double')" id="doubleBtn">
            <i class="fas fa-gem"></i> DUPLA PONTUA√á√ÉO (1)
          </button>
          <button class="powerup-btn" onclick="usePowerUp('skip')" id="skipBtn">
            <i class="fas fa-forward"></i> PULAR PERGUNTA (1)
          </button>
        </div>
      </div>

      <div class="scoreboard">
        <h3 class="scoreboard-title">
          <i class="fas fa-chart-bar"></i> PLACAR - RODADA
          <span id="currentRound">1</span>/<span id="totalRounds">10</span>
        </h3>
        <div id="scoreList" class="scores-list"></div>
      </div>

      <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-top: 30px;">
        <button class="btn btn-warning" onclick="pauseGame()">
          <i class="fas fa-pause"></i> PAUSAR
        </button>
        <button class="btn btn-info" onclick="showHint()" id="hintBtn">
          <i class="fas fa-lightbulb"></i> DICA (-3 pts)
        </button>
        <button class="btn btn-danger" onclick="confirmQuit()">
          <i class="fas fa-sign-out-alt"></i> SAIR
        </button>
      </div>
    </div>

    <div id="resultsScreen" class="hidden">
      <div class="results-screen">
        <div id="winnerCrown" class="winner-crown"></div>
        <h2 id="winnerTitle" class="winner-title"></h2>
        <div id="winnerScore" class="winner-score"></div>

        <div class="scoreboard mt-30">
          <h3 class="scoreboard-title"><i class="fas fa-chart-pie"></i> ESTAT√çSTICAS DA PARTIDA</h3>
          <div id="gameStats" style="text-align: left; padding: 20px;"></div>
        </div>

        <div id="achievementsDisplay" class="scoreboard mt-30" style="display: none;">
          <h3 class="scoreboard-title"><i class="fas fa-medal"></i> CONQUISTAS DESBLOQUEADAS</h3>
          <div id="achievementsList"></div>
        </div>

        <div style="display: flex; gap: 15px; justify-content: center; margin-top: 40px; flex-wrap: wrap;">
          <button class="btn btn-family" onclick="rematch()">
            <i class="fas fa-redo"></i> REVANCHE
          </button>
          <button class="btn btn-success" onclick="newGame()">
            <i class="fas fa-plus-circle"></i> NOVA PARTIDA
          </button>
          <button class="btn btn-secondary" onclick="backToMenu()">
            <i class="fas fa-home"></i> MENU PRINCIPAL
          </button>
          <button class="btn btn-info" onclick="shareResults()">
            <i class="fas fa-share-alt"></i> COMPARTILHAR
          </button>
        </div>
      </div>
    </div>

  </div>
</div>

<div id="instructionsModal" class="modal-overlay">
  <div class="modal-content">
    <h2 style="color: var(--secondary); margin-bottom: 25px; text-align: center;">
      <i class="fas fa-graduation-cap"></i> COMO JOGAR - SHOW DA FAM√çLIA
    </h2>

    <div style="line-height: 1.8; font-size: 1.1rem;">
      <p style="color:#cbd5e1; margin-bottom: 15px;">
        Escolha o modo, configure jogadores e responda perguntas. Use power-ups com estrat√©gia.
      </p>
      <ul style="list-style: none; padding-left: 10px;">
        <li style="margin: 10px 0; border-left: 3px solid var(--info); padding-left: 10px;"><strong>Cl√°ssico:</strong> sem limite pr√°tico (ou at√© acabar sua paci√™ncia).</li>
        <li style="margin: 10px 0; border-left: 3px solid var(--success); padding-left: 10px;"><strong>R√°pido:</strong> n√∫mero fixo de rodadas.</li>
        <li style="margin: 10px 0; border-left: 3px solid var(--warning); padding-left: 10px;"><strong>Duelo:</strong> 1x1 (melhor de 3 voc√™ pode adaptar).</li>
        <li style="margin: 10px 0; border-left: 3px solid var(--family-purple); padding-left: 10px;"><strong>Times:</strong> crian√ßas vs adultos.</li>
        <li style="margin: 10px 0; border-left: 3px solid var(--danger); padding-left: 10px;"><strong>Survival:</strong> errou/tempo acabou, eliminou.</li>
        <li style="margin: 10px 0; border-left: 3px solid var(--family-blue); padding-left: 10px;"><strong>Coop:</strong> joguem juntos (regras podem ser ajustadas).</li>
      </ul>
    </div>

    <button class="btn btn-primary mt-30" onclick="closeModal('instructionsModal')">
      <i class="fas fa-thumbs-up"></i> ENTENDI, VAMOS JOGAR!
    </button>
  </div>
</div>

<div id="recordsModal" class="modal-overlay">
  <div class="modal-content">
    <h2 style="color: var(--warning); margin-bottom: 25px; text-align: center;">
      <i class="fas fa-trophy"></i> HALL DA FAMA DA FAM√çLIA
    </h2>
    <div id="hallOfFame"></div>
    <button class="btn btn-secondary mt-30" onclick="closeModal('recordsModal')">
      <i class="fas fa-times"></i> FECHAR
    </button>
  </div>
</div>

<script>

  (function () {
  function showFatal(msg) {
    let box = document.getElementById('fatalErrorBox');
    if (!box) {
      box = document.createElement('div');
      box.id = 'fatalErrorBox';
      box.style.cssText = `
        position: fixed;
        top: 10px; left: 10px; right: 10px;
        z-index: 999999;
        background: rgba(239, 68, 68, 0.95);
        color: #fff;
        padding: 12px 14px;
        border-radius: 10px;
        font-family: system-ui, sans-serif;
        font-size: 14px;
        white-space: pre-wrap;
        box-shadow: 0 10px 30px rgba(0,0,0,.35);
      `;
      document.body.appendChild(box);
    }
    box.textContent = msg;
  }

  window.addEventListener('error', (e) => {
    showFatal(`ERRO JS:\n${e.message}\nArquivo: ${e.filename}\nLinha: ${e.lineno}:${e.colno}`);
  });

  window.addEventListener('unhandledrejection', (e) => {
    const reason = (e && e.reason) ? (e.reason.stack || e.reason.message || String(e.reason)) : 'Sem detalhes';
    showFatal(`PROMISE REJEITADA:\n${reason}`);
  });
})();
// =========================
// Seguran√ßa: localStorage
// =========================
function safeGetLocalStorage(key, fallback) {
  try {
    const raw = localStorage.getItem(key);
    if (!raw) return fallback;
    return JSON.parse(raw);
  } catch (e) {
    console.warn('‚ö†Ô∏è localStorage indispon√≠vel/bloqueado. Rodando sem recordes.', e);
    return fallback;
  }
}

function safeSetLocalStorage(key, value) {
  try {
    localStorage.setItem(key, JSON.stringify(value));
  } catch (e) {
    console.warn('‚ö†Ô∏è N√£o foi poss√≠vel salvar no localStorage.', e);
  }
}

// ============================================
// BANCO DE DADOS DO JOGO
// ============================================
const GameConfig = {
  audioEnabled: true,
  speechRate: 0.9,
  version: '2.0.0'
};

const GameState = {
  mode: 'classic',
  difficulty: 'medium',
  players: [],
  scores: [],
  streaks: [],
  powerUps: [],

  currentPlayer: 0,
  currentRound: 1,
  totalRounds: 10,
  questions: [],
  usedQuestions: new Set(),

  gameActive: false,
  timer: 30,
  timerInterval: null,
  doublePoints: false,
  gamePaused: false,

  currentQuestionIndex: null,
  currentCorrectIndex: null,
  currentCategoryKey: null,
  currentPoints: null,
  questionStartAt: null,

  stats: {
    totalQuestions: 0,
    correctAnswers: 0,
    fastestAnswer: 999,
    categories: {},
    powerUpsUsed: 0,
    hintsUsed: 0,
    startTime: null,
    achievements: new Set()
  },

  records: safeGetLocalStorage('familyShowRecords', [])
};

const Categories = {
  matematica: { name: 'üßÆ MATEM√ÅTICA', color: '#3b82f6', icon: 'fa-calculator', difficulties: ['easy', 'medium', 'hard', 'expert'] },
  geografia: { name: 'üåé GEOGRAFIA', color: '#10b981', icon: 'fa-globe-americas', difficulties: ['easy', 'medium', 'hard'] },
  historia: { name: 'üèõÔ∏è HIST√ìRIA', color: '#f59e0b', icon: 'fa-landmark', difficulties: ['easy', 'medium', 'hard'] },
  ciencia: { name: 'üî¨ CI√äNCIA', color: '#8b5cf6', icon: 'fa-flask', difficulties: ['easy', 'medium', 'hard', 'expert'] },
  portugues: { name: 'üìö PORTUGU√äS', color: '#6366f1', icon: 'fa-book', difficulties: ['easy', 'medium'] },
  entretenimento: { name: 'üé¨ ENTRETENIMENTO', color: '#ec4899', icon: 'fa-film', difficulties: ['easy', 'medium'] },
  esportes: { name: '‚öΩ ESPORTES', color: '#ef4444', icon: 'fa-futbol', difficulties: ['easy', 'medium'] },
  curiosidades: { name: 'ü§î CURIOSIDADES', color: '#f97316', icon: 'fa-lightbulb', difficulties: ['easy', 'medium', 'hard'] },
  pegadinhas: { name: 'üé≠ PEGADINHAS', color: '#8b5cf6', icon: 'fa-theater-masks', difficulties: ['medium', 'hard'] },
  familia: { name: 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶ FAM√çLIA', color: '#f59e0b', icon: 'fa-users', difficulties: ['easy', 'medium'] }
};

const QuestionsDB = {
  easy: [
    ['üßÆ Quanto √© 5 + 7?', ['12', '13', '11', '10'], 0, 'matematica', 5],
    ['üßÆ Quanto √© 10 x 3?', ['30', '13', '20', '33'], 0, 'matematica', 5],
    ['üßÆ Qual √© o dobro de 8?', ['16', '4', '10', '8'], 0, 'matematica', 5],
    ['üßÆ Quanto √© 15 - 6?', ['9', '8', '10', '11'], 0, 'matematica', 5],
    ['üßÆ Quanto √© 20 √∑ 4?', ['5', '4', '6', '8'], 0, 'matematica', 5],

    ['üåé Qual √© a capital do Brasil?', ['Bras√≠lia', 'Rio de Janeiro', 'S√£o Paulo', 'Salvador'], 0, 'geografia', 5],
    ['üåé Qual oceano banha o Brasil?', ['Atl√¢ntico', 'Pac√≠fico', '√çndico', '√Årtico'], 0, 'geografia', 5],
    ['üåé Quantos estados tem o Brasil?', ['26', '25', '27', '24'], 0, 'geografia', 5],

    ['üèõÔ∏è Quem descobriu o Brasil?', ['Pedro √Ålvares Cabral', 'Crist√≥v√£o Colombo', 'Dom Pedro I', 'Tiradentes'], 0, 'historia', 5],
    ['üèõÔ∏è Qual a cor da bandeira do Brasil?', ['Verde e amarela', 'Vermelha e branca', 'Azul e branca', 'Verde e vermelha'], 0, 'historia', 5],

    ['üî¨ Quantos planetas tem no Sistema Solar?', ['8', '7', '9', '10'], 0, 'ciencia', 5],
    ['üî¨ Qual planeta √© conhecido como planeta vermelho?', ['Marte', 'V√™nus', 'Terra', 'J√∫piter'], 0, 'ciencia', 5],
    ['üî¨ Que animal √© o maior do mundo?', ['Baleia azul', 'Elefante', 'Tubar√£o-baleia', 'Girafa'], 0, 'ciencia', 5],

    ['üìö Quantas letras tem o alfabeto portugu√™s?', ['26', '24', '27', '23'], 0, 'portugues', 5],
    ['üìö Qual o plural de "c√£o"?', ['C√£es', 'C√£os', 'C√£ezinhos', 'C√£oz√µes'], 0, 'portugues', 5],
    ['üìö Complete: "O gato ___ o rato"', ['persegue', 'perseguem', 'perseguir', 'perseguindo'], 0, 'portugues', 5],

    ['üé¨ Quem √© o rei do pop?', ['Michael Jackson', 'Elvis Presley', 'Madonna', 'Beyonc√©'], 0, 'entretenimento', 5],
    ['üé¨ Qual √© o filme da Disney com uma princesa chamada Elsa?', ['Frozen', 'Moana', 'Valente', 'Encanto'], 0, 'entretenimento', 5],
    ['üé¨ Quem criou o Mickey Mouse?', ['Walt Disney', 'Steven Spielberg', 'George Lucas', 'Stan Lee'], 0, 'entretenimento', 5],

    ['‚öΩ Quantos jogadores tem um time de futebol?', ['11', '10', '12', '9'], 0, 'esportes', 5],
    ['‚öΩ Em que pa√≠s nasceu o futebol?', ['Inglaterra', 'Brasil', 'Alemanha', 'It√°lia'], 0, 'esportes', 5],
    ['üèÄ Quantos pontos vale uma cesta de tr√™s pontos no basquete?', ['3', '2', '1', '4'], 0, 'esportes', 5],

    ['ü§î Qual animal √© conhecido como "melhor amigo do homem"?', ['Cachorro', 'Gato', 'P√°ssaro', 'Peixe'], 0, 'curiosidades', 5],
    ['ü§î Quantos dias tem uma semana?', ['7', '5', '6', '8'], 0, 'curiosidades', 5],
    ['ü§î Qual √© a cor do c√©u em um dia claro?', ['Azul', 'Verde', 'Vermelho', 'Amarelo'], 0, 'curiosidades', 5],

    ['üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Se seu pai tem um filho que n√£o √© seu irm√£o, quem √© ele?', ['Voc√™', 'Seu primo', 'Seu tio', 'Seu av√¥'], 0, 'familia', 5],
    ['üë®‚Äçüë©‚Äçüëß‚Äçüë¶ A irm√£ da sua m√£e √© sua...?', ['Tia', 'Prima', 'Madrinha', 'Sogra'], 0, 'familia', 5],
    ['üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Quantas pessoas s√£o um casal?', ['2', '1', '3', '4'], 0, 'familia', 5],

    ['üé≠ O pai de Jo√£o tem 4 filhos: Jo√£o, Jo√£ozinho, Jo√£oz√£o e...?', ['Jo√£o', 'Maria', 'Jos√©', 'Pedro'], 0, 'pegadinhas', 10],
    ['üé≠ Quantos meses tem 28 dias?', ['Todos', 'Apenas fevereiro', '6 meses', '3 meses'], 0, 'pegadinhas', 10],
    ['üé≠ Se voc√™ tem 3 ma√ß√£s e tira 2, quantas voc√™ tem?', ['2', '1', '3', '5'], 0, 'pegadinhas', 10]
  ],

  medium: [
    ['üßÆ Quanto √© 15 x 4?', ['60', '45', '50', '55'], 0, 'matematica', 10],
    ['üßÆ Qual √© a raiz quadrada de 64?', ['8', '6', '7', '9'], 0, 'matematica', 10],
    ['üßÆ Quanto √© 25% de 200?', ['50', '25', '75', '100'], 0, 'matematica', 10],
    ['üßÆ Qual o pr√≥ximo n√∫mero: 2, 4, 6, 8...?', ['10', '9', '12', '7'], 0, 'matematica', 10],
    ['üßÆ Quanto √© 3¬≥?', ['27', '9', '6', '12'], 0, 'matematica', 10],

    ['üåé Qual √© o maior pa√≠s do mundo em √°rea?', ['R√∫ssia', 'China', 'Canad√°', 'EUA'], 0, 'geografia', 10],
    ['üåé Qual √© o menor pa√≠s do mundo?', ['Vaticano', 'M√¥naco', 'San Marino', 'Liechtenstein'], 0, 'geografia', 10],
    ['üåé Qual rio √© o mais longo do mundo?', ['Amazonas', 'Nilo', 'Yangtz√©', 'Mississippi'], 1, 'geografia', 10],
    ['üåé Qual a capital da Fran√ßa?', ['Paris', 'Londres', 'Roma', 'Berlim'], 0, 'geografia', 10],
    ['üåé Em qual continente fica o Egito?', ['√Åfrica', '√Åsia', 'Europa', 'Am√©rica'], 0, 'geografia', 10],

    ['üèõÔ∏è Em que ano o Brasil se tornou independente?', ['1822', '1500', '1889', '1815'], 0, 'historia', 10],
    ['üèõÔ∏è Quem foi o primeiro presidente do Brasil?', ['Deodoro da Fonseca', 'Get√∫lio Vargas', 'Juscelino Kubitschek', 'Dom Pedro II'], 0, 'historia', 10],
    ['üèõÔ∏è Quem proclamou a Rep√∫blica no Brasil?', ['Marechal Deodoro', 'Dom Pedro II', 'Tiradentes', 'Duque de Caxias'], 0, 'historia', 10],
    ['üèõÔ∏è Em que ano terminou a Segunda Guerra Mundial?', ['1945', '1939', '1941', '1943'], 0, 'historia', 10],
    ['üèõÔ∏è Quem foi o inventor da l√¢mpada?', ['Thomas Edison', 'Nikola Tesla', 'Albert Einstein', 'Isaac Newton'], 0, 'historia', 10],

    ['üî¨ Qual √© o maior animal terrestre?', ['Elefante africano', 'Girafa', 'Baleia azul', 'Urso polar'], 0, 'ciencia', 10],
    ['üî¨ Quantos ossos tem o corpo humano adulto?', ['206', '200', '210', '196'], 0, 'ciencia', 10],
    ['üî¨ Qual g√°s √© mais abundante na atmosfera?', ['Nitrog√™nio', 'Oxig√™nio', 'G√°s Carb√¥nico', 'Arg√¥nio'], 0, 'ciencia', 10],
    ['üî¨ Quantas pernas tem uma aranha?', ['8', '6', '10', '12'], 0, 'ciencia', 10],
    ['üî¨ Que planeta √© conhecido como "planeta azul"?', ['Terra', 'Netuno', 'Urano', 'Marte'], 0, 'ciencia', 10],

    ['üìö Quantas s√≠labas tem a palavra "paralelep√≠pedo"?', ['7', '6', '8', '5'], 0, 'portugues', 10],
    ['üìö Qual destas palavras √© um substantivo?', ['Casa', 'Correr', 'Bonito', 'Rapidamente'], 0, 'portugues', 10],
    ['üìö Qual √© o aumentativo de "casa"?', ['Cas√£o', 'Casar√£o', 'Casinha', 'Casebre'], 1, 'portugues', 10],
    ['üìö Qual destas palavras est√° grafada corretamente?', ['Exce√ß√£o', 'Excess√£o', 'Exces√£o', 'Excec√£o'], 0, 'portugues', 10],
    ['üìö Complete: "Ele ___ ao mercado"', ['foi', 'fui', 'vai', 'vou'], 0, 'portugues', 10],

    ['üé¨ Quem pintou a Mona Lisa?', ['Leonardo da Vinci', 'Vincent van Gogh', 'Pablo Picasso', 'Michelangelo'], 0, 'entretenimento', 10],
    ['üé¨ Qual empresa criou o Mickey Mouse?', ['Disney', 'Warner Bros', 'Pixar', 'DreamWorks'], 0, 'entretenimento', 10],
    ['üé¨ Quantos an√©is de poder existem em "O Senhor dos An√©is"?', ['20', '1', '3', '7'], 0, 'entretenimento', 10],
    ['üé¨ Qual √© o nome do rob√¥ em "Star Wars"?', ['R2-D2', 'C-3PO', 'BB-8', 'D-0'], 0, 'entretenimento', 10],
    ['üé¨ Quem escreveu "Harry Potter"?', ['J.K. Rowling', 'Stephen King', 'George R.R. Martin', 'J.R.R. Tolkien'], 0, 'entretenimento', 10],

    ['‚öΩ Quantas Copa do Mundo o Brasil ganhou?', ['5', '4', '6', '3'], 0, 'esportes', 10],
    ['‚öΩ Qual jogador brasileiro √© conhecido como "Rei do Futebol"?', ['Pel√©', 'Maradona', 'Messi', 'Ronaldo'], 0, 'esportes', 10],
    ['üèÄ Qual √© a altura oficial da cesta de basquete?', ['3,05m', '2,80m', '3,20m', '2,95m'], 0, 'esportes', 10],
    ['üéæ Quantos pontos s√£o necess√°rios para ganhar um game no t√™nis?', ['4', '3', '5', '6'], 0, 'esportes', 10],
    ['üèä Quantas medalhas de ouro Michael Phelps tem nas Olimp√≠adas?', ['23', '15', '28', '19'], 0, 'esportes', 10],

    ['ü§î Quantos lados tem um hex√°gono?', ['6', '5', '7', '8'], 0, 'curiosidades', 10],
    ['ü§î Que animal dorme de cabe√ßa para baixo?', ['Morcego', 'Pregui√ßa', 'Coruja', 'Esquilo'], 0, 'curiosidades', 10],
    ['ü§î Quantos continentes existem no mundo?', ['7', '5', '6', '8'], 0, 'curiosidades', 10],
    ['ü§î Qual √© o metal l√≠quido √† temperatura ambiente?', ['Merc√∫rio', 'Ouro', 'Prata', 'Ferro'], 0, 'curiosidades', 10],
    ['ü§î Quantos sentidos humanos existem?', ['5', '4', '6', '7'], 0, 'curiosidades', 10],

    ['üé≠ Um avi√£o cai na fronteira entre Brasil e Argentina. Onde enterram os sobreviventes?', ['Sobreviventes n√£o se enterram', 'No Brasil', 'Na Argentina', 'No pa√≠s de origem'], 0, 'pegadinhas', 15],
    ['üé≠ Se 2 √© companheiro, 3 √© multid√£o, 4 e 5 √©...?', ['Muito', 'Demais', '9', 'Nada'], 2, 'pegadinhas', 15],
    ['üé≠ Quantas letras tem a palavra "alfabeto"?', ['8', '7', '9', '10'], 0, 'pegadinhas', 15],
    ['üé≠ Um pato d√° 3 voltas em torno de um lago em 3 minutos. Em quanto tempo 3 patos d√£o 3 voltas?', ['3 minutos', '9 minutos', '1 minuto', '6 minutos'], 0, 'pegadinhas', 15],
    ['üé≠ O que √© que quanto mais voc√™ tira, maior fica?', ['Buraco', 'Fogo', 'Dinheiro', 'Tempo'], 0, 'pegadinhas', 15],

    ['üë®‚Äçüë©‚Äçüëß‚Äçüë¶ O irm√£o do seu pai √© seu...?', ['Tio', 'Primo', 'Sobrinho', 'Av√¥'], 0, 'familia', 10],
    ['üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Se voc√™ tem uma irm√£, e ela tem um irm√£o, quantos irm√£os voc√™ tem?', ['1', '2', '0', '3'], 0, 'familia', 10],
    ['üë®‚Äçüë©‚Äçüëß‚Äçüë¶ A m√£e do seu pai √© sua...?', ['Av√≥', 'Tia', 'Madrinha', 'Bisav√≥'], 0, 'familia', 10]
  ],

  hard: [
    ['üßÆ Quanto √© 17¬≤?', ['289', '279', '299', '269'], 0, 'matematica', 15],
    ['üßÆ Quantos graus tem a soma dos √¢ngulos internos de um tri√¢ngulo?', ['180¬∞', '90¬∞', '360¬∞', '270¬∞'], 0, 'matematica', 15],
    ['üßÆ Qual √© o valor de œÄ com duas casas decimais?', ['3.14', '3.15', '3.16', '3.13'], 0, 'matematica', 15],
    ['üßÆ Quanto √© a raiz c√∫bica de 27?', ['3', '9', '6', '1'], 0, 'matematica', 15],
    ['üßÆ Qual √© o MMC de 12 e 18?', ['36', '24', '48', '54'], 0, 'matematica', 15],

    ['üåé Qual o pa√≠s com maior popula√ß√£o do mundo?', ['China', '√çndia', 'EUA', 'Indon√©sia'], 0, 'geografia', 15],
    ['üåé Qual a capital da Austr√°lia?', ['Camberra', 'Sydney', 'Melbourne', 'Perth'], 0, 'geografia', 15],
    ['üåé Em que pa√≠s fica a Torre Eiffel?', ['Fran√ßa', 'It√°lia', 'Espanha', 'Alemanha'], 0, 'geografia', 15],
    ['üåé Qual √© o maior deserto do mundo?', ['Ant√°rtida', 'Saara', 'Ar√°bia', 'Gobi'], 0, 'geografia', 15],
    ['üåé Quantos pa√≠ses fazem parte da Uni√£o Europeia?', ['27', '25', '30', '28'], 0, 'geografia', 15],

    ['üèõÔ∏è Em que ano come√ßou a Segunda Guerra Mundial?', ['1939', '1914', '1945', '1933'], 0, 'historia', 15],
    ['üèõÔ∏è Quem foi o primeiro homem a pisar na Lua?', ['Neil Armstrong', 'Buzz Aldrin', 'Yuri Gagarin', 'Michael Collins'], 0, 'historia', 15],
    ['üèõÔ∏è Em que ano foi proclamada a Rep√∫blica no Brasil?', ['1889', '1822', '1891', '1900'], 0, 'historia', 15],
    ['üèõÔ∏è Quem foi o √∫ltimo imperador do Brasil?', ['Dom Pedro II', 'Dom Pedro I', 'Dom Jo√£o VI', 'Princesa Isabel'], 0, 'historia', 15],
    ['üèõÔ∏è Quem pintou "A √öltima Ceia"?', ['Leonardo da Vinci', 'Michelangelo', 'Rafael', 'Donatello'], 0, 'historia', 15],

    ['üî¨ Qual √© o elemento qu√≠mico mais abundante no universo?', ['Hidrog√™nio', 'Oxig√™nio', 'H√©lio', 'Carbono'], 0, 'ciencia', 15],
    ['üî¨ Quantos cromossomos tem uma c√©lula humana normal?', ['46', '23', '48', '24'], 0, 'ciencia', 15],
    ['üî¨ Qual a velocidade da luz no v√°cuo?', ['300.000 km/s', '150.000 km/s', '450.000 km/s', '1.000.000 km/s'], 0, 'ciencia', 15],
    ['üî¨ Que planeta tem os maiores an√©is?', ['Saturno', 'J√∫piter', 'Urano', 'Netuno'], 0, 'ciencia', 15],
    ['üî¨ Quantas patas tem um inseto?', ['6', '8', '4', '10'], 0, 'ciencia', 15],

    ['üé≠ Qual √© o animal que tem 4 patas de manh√£, 2 ao meio-dia e 3 √† tarde?', ['O homem', 'Macaco', 'Cavalo', 'Gato'], 0, 'pegadinhas', 20],
    ['üé≠ Um homem olha para uma foto e diz: "Irm√£os e irm√£s eu n√£o tenho, mas o pai desse homem √© filho do meu pai". Quem √© o homem da foto?', ['Seu filho', 'Seu pai', 'Ele mesmo', 'Seu av√¥'], 0, 'pegadinhas', 20],
    ['üé≠ Quanto tempo leva para cozinhar 6 ovos, se 2 levam 4 minutos?', ['4 minutos', '8 minutos', '12 minutos', '6 minutos'], 0, 'pegadinhas', 20]
  ],

  expert: [
    ['üßÆ Quanto √© a derivada de x¬≥?', ['3x¬≤', 'x¬≤', '3x', 'x¬≥'], 0, 'matematica', 20],
    ['üßÆ Qual o logaritmo de 100 na base 10?', ['2', '1', '10', '100'], 0, 'matematica', 20],
    ['üßÆ Qual √© o seno de 90 graus?', ['1', '0', '0.5', '‚àö2/2'], 0, 'matematica', 20],
    ['üßÆ Quanto √© 5! (fatorial)?', ['120', '60', '24', '720'], 0, 'matematica', 20],

    ['üî¨ Quem desenvolveu a teoria da relatividade?', ['Albert Einstein', 'Isaac Newton', 'Stephen Hawking', 'Galileu Galilei'], 0, 'ciencia', 20],
    ['üî¨ Qual √© a f√≥rmula qu√≠mica da √°gua?', ['H‚ÇÇO', 'CO‚ÇÇ', 'NaCl', 'O‚ÇÇ'], 0, 'ciencia', 20],
    ['üî¨ Que cientista descobriu a penicilina?', ['Alexander Fleming', 'Louis Pasteur', 'Marie Curie', 'Gregor Mendel'], 0, 'ciencia', 20],
    ['üî¨ Quantas v√©rtebras tem a coluna cervical humana?', ['7', '5', '12', '24'], 0, 'ciencia', 20],

    ['üèõÔ∏è Em que ano Crist√≥v√£o Colombo chegou √† Am√©rica?', ['1492', '1500', '1453', '1519'], 0, 'historia', 20],
    ['üèõÔ∏è Quem foi o primeiro presidente dos Estados Unidos?', ['George Washington', 'Abraham Lincoln', 'Thomas Jefferson', 'John Adams'], 0, 'historia', 20],

    ['üåé Qual √© o ponto mais alto da Terra?', ['Monte Everest', 'K2', 'Monte Kilimanjaro', 'Monte McKinley'], 0, 'geografia', 20],
    ['üåé Qual √© o maior oceano do mundo?', ['Pac√≠fico', 'Atl√¢ntico', '√çndico', '√Årtico'], 0, 'geografia', 20]
  ]
};

const Achievements = {
  first_blood: { name: "Primeiro Sangue ü©∏", description: "Acertou a primeira pergunta do jogo", icon: "ü©∏" },
  streak_3: { name: "Em Chamas üî•", description: "Acertou 3 perguntas consecutivas", icon: "üî•" },
  streak_5: { name: "Lenda Viva ‚ö°", description: "Acertou 5 perguntas consecutivas", icon: "‚ö°" },
  perfect_round: { name: "Perfei√ß√£o ‚ú®", description: "Acertou todas as perguntas de uma rodada", icon: "‚ú®" },
  speed_demon: { name: "Rel√¢mpago ‚ö°", description: "Respondeu em menos de 3 segundos", icon: "‚è±Ô∏è" },
  comeback: { name: "Virada Hist√≥rica üìà", description: "Venceu estando atr√°s na √∫ltima rodada", icon: "üìà" },
  family_help: { name: "Fam√≠lia Unida üë®‚Äçüë©‚Äçüëß‚Äçüë¶", description: "Usou todos os power-ups de ajuda", icon: "üë®‚Äçüë©‚Äçüëß‚Äçüë¶" },
  math_master: { name: "Mestre da Matem√°tica üßÆ", description: "Acertou 10 perguntas de matem√°tica", icon: "üßÆ" },
  geography_expert: { name: "Explorador üåé", description: "Acertou 10 perguntas de geografia", icon: "üåé" },
  history_buff: { name: "Historiador üèõÔ∏è", description: "Acertou 10 perguntas de hist√≥ria", icon: "üèõÔ∏è" }
};

const FunnyErrors = [
  "Essa foi longe, hein!",
  "C√©rebro deu tela azul!",
  "A galinha cantou fora do tom!",
  "Resposta de outro planeta!",
  "Errou feio, errou rude!"
];

const MotivationalPhrases = [
  "EXCELENTE!",
  "INCR√çVEL!",
  "BRILHANTE!",
  "NA MOSCA!",
  "ESPETACULAR!"
];

// ============================================
// UTILIT√ÅRIOS
// ============================================
function shuffleArray(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
  return array;
}

function getRandomItem(array) {
  return array[Math.floor(Math.random() * array.length)];
}

function generateMathQuestion(difficulty) {
  let a, b, operation, points;

  switch (difficulty) {
    case 'easy':
      a = Math.floor(Math.random() * 20) + 1;
      b = Math.floor(Math.random() * 20) + 1;
      operation = Math.random() > 0.5 ? '+' : '√ó';
      points = 5;
      break;
    case 'medium':
      a = Math.floor(Math.random() * 50) + 1;
      b = Math.floor(Math.random() * 50) + 1;
      operation = ['+', '-', '√ó'][Math.floor(Math.random() * 3)];
      points = 10;
      break;
    case 'hard':
      a = Math.floor(Math.random() * 100) + 1;
      b = Math.floor(Math.random() * 100) + 1;
      operation = ['+', '-', '√ó', '√∑'][Math.floor(Math.random() * 4)];
      points = 15;
      break;
    case 'expert':
      a = Math.floor(Math.random() * 100) + 1;
      b = Math.floor(Math.random() * 100) + 1;
      operation = ['+', '-', '√ó', '√∑', '¬≤', '‚àö'][Math.floor(Math.random() * 6)];
      points = 20;
      break;
    default:
      a = Math.floor(Math.random() * 50) + 1;
      b = Math.floor(Math.random() * 50) + 1;
      operation = '+';
      points = 10;
  }

  let question, correctAnswer;

  switch (operation) {
    case '+': question = `üßÆ Quanto √© ${a} + ${b}?`; correctAnswer = a + b; break;
    case '-': question = `üßÆ Quanto √© ${a} - ${b}?`; correctAnswer = a - b; break;
    case '√ó': question = `üßÆ Quanto √© ${a} √ó ${b}?`; correctAnswer = a * b; break;
    case '√∑':
      b = Math.floor(Math.random() * 10) + 1;
      a = b * (Math.floor(Math.random() * 10) + 1);
      question = `üßÆ Quanto √© ${a} √∑ ${b}?`;
      correctAnswer = a / b;
      break;
    case '¬≤':
      question = `üßÆ Quanto √© ${a}¬≤?`;
      correctAnswer = a * a;
      break;
    case '‚àö':
      a = Math.floor(Math.random() * 10) + 1;
      const square = a * a;
      question = `üßÆ Qual √© a raiz quadrada de ${square}?`;
      correctAnswer = a;
      break;
  }

  const options = [correctAnswer];
  while (options.length < 4) {
    const wrong = correctAnswer + (Math.floor(Math.random() * 20) - 10);
    if (wrong !== correctAnswer && !options.includes(wrong) && wrong > 0) options.push(wrong);
  }

  shuffleArray(options);
  const correctIndex = options.indexOf(correctAnswer);

  return [question, options.map(String), correctIndex, 'matematica', points];
}

function showNotification(message, type = 'info') {
  const colors = {
    success: 'var(--success)',
    error: 'var(--danger)',
    warning: 'var(--warning)',
    info: 'var(--info)'
  };

  const notification = document.createElement('div');
  notification.style.cssText = `
    position: fixed;
    top: 100px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(15, 23, 42, 0.95);
    color: white;
    padding: 20px 30px;
    border-radius: 15px;
    border: 3px solid ${colors[type] || colors.info};
    z-index: 10000;
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    animation: notificationSlideIn 0.3s ease-out;
    max-width: 90%;
    text-align: center;
    font-weight: bold;
    font-size: 1.1rem;
    backdrop-filter: blur(10px);
  `;
  notification.textContent = message;
  document.body.appendChild(notification);

  setTimeout(() => {
    notification.style.animation = 'notificationSlideOut 0.3s ease-out';
    setTimeout(() => notification.remove(), 300);
  }, 2500);
}

function speak(text) {
  if (!GameConfig.audioEnabled) return;
  if (!('speechSynthesis' in window)) return;

  window.speechSynthesis.cancel();
  const utterance = new SpeechSynthesisUtterance(text);
  utterance.lang = 'pt-BR';
  utterance.rate = GameConfig.speechRate;
  utterance.volume = 1;
  window.speechSynthesis.speak(utterance);
}

function createConfetti() {
  const colors = ['#f59e0b', '#3b82f6', '#10b981', '#8b5cf6', '#ec4899', '#ef4444'];
  for (let i = 0; i < 120; i++) {
    const confetti = document.createElement('div');
    confetti.className = 'confetti';
    confetti.style.cssText = `
      width: ${Math.random() * 16 + 8}px;
      height: ${Math.random() * 16 + 8}px;
      background: ${colors[Math.floor(Math.random() * colors.length)]};
      top: -50px;
      left: ${Math.random() * 100}vw;
      border-radius: ${Math.random() > 0.5 ? '50%' : '0'};
      animation: confettiRain ${Math.random() * 3 + 2}s linear forwards;
      opacity: 0.9;
      transform: rotate(${Math.random() * 360}deg);
    `;
    document.body.appendChild(confetti);
    setTimeout(() => confetti.remove(), 5000);
  }
}

function saveRecord(score, player, mode, difficulty) {
  const record = {
    score,
    player,
    mode,
    difficulty,
    date: new Date().toLocaleDateString('pt-BR'),
    timestamp: Date.now()
  };

  GameState.records.push(record);
  GameState.records.sort((a, b) => b.score - a.score);
  if (GameState.records.length > 10) GameState.records.length = 10;

  safeSetLocalStorage('familyShowRecords', GameState.records);
}

// ============================================
// MODOS (CORRE√á√ÉO: selectMode EXISTE)
// ============================================
function selectMode(modeKey) {
  GameState.mode = modeKey;

  const cards = document.querySelectorAll('.mode-card');
  cards.forEach(c => c.classList.remove('selected'));

  // Seleciona o card clicado pelo modo (baseado no texto do h3)
  cards.forEach(c => {
    const t = (c.querySelector('h3')?.textContent || '').toLowerCase();
    const map = {
      classic: 'cl√°ssico',
      quick: 'r√°pido',
      duel: 'duelo',
      teams: 'times',
      survival: 'survival',
      coop: 'cooperativo'
    };
    if (t.includes(map[modeKey])) c.classList.add('selected');
  });

  showNotification(`üéÆ Modo selecionado: ${modeKey.toUpperCase()}`, 'info');
}

// ============================================
// INICIALIZA√á√ÉO
// ============================================
function initGame() {
  console.log('üéÆ Inicializando Show da Fam√≠lia...');

  setupEventListeners();
  loadRecords();
  setupAudio();
  generateQuestions();
  showQuickStats();

  // Seleciona cl√°ssico por padr√£o
  selectMode('classic');

  console.log('‚úÖ Jogo inicializado com sucesso!');
}

function setupEventListeners() {
  const playerSlider = document.getElementById('numPlayers');
  const playerCount = document.getElementById('playerCount');

  playerSlider.addEventListener('input', function () {
    playerCount.textContent = `${this.value} JOGADORES`;
  });

  document.getElementById('audioToggle').addEventListener('click', toggleAudio);
}

function setupAudio() {
  if (!('speechSynthesis' in window)) {
    console.warn('‚ö†Ô∏è Navegador n√£o suporta s√≠ntese de voz');
    GameConfig.audioEnabled = false;
    const btn = document.getElementById('audioToggle');
    btn.innerHTML = '<i class="fas fa-volume-mute"></i>';
    btn.title = '√Åudio n√£o suportado';
    btn.style.opacity = '0.5';
    btn.style.cursor = 'not-allowed';
  }
}

function toggleAudio() {
  if (!('speechSynthesis' in window)) return;

  GameConfig.audioEnabled = !GameConfig.audioEnabled;
  const audioBtn = document.getElementById('audioToggle');

  if (GameConfig.audioEnabled) {
    audioBtn.innerHTML = '<i class="fas fa-volume-up"></i>';
    audioBtn.title = 'Som ligado';
    audioBtn.style.background = 'rgba(16, 185, 129, 0.9)';
    speak("Som ativado! Vamos jogar!");
    showNotification('üîä Som ativado!', 'success');
  } else {
    audioBtn.innerHTML = '<i class="fas fa-volume-mute"></i>';
    audioBtn.title = 'Som desligado';
    audioBtn.style.background = 'rgba(15, 23, 42, 0.9)';
    window.speechSynthesis.cancel();
    showNotification('üîá Som desativado', 'warning');
  }
}

// ============================================
// CONFIGURA√á√ÉO
// ============================================
function setupPlayers() {
  const numPlayers = parseInt(document.getElementById('numPlayers').value, 10);
  GameState.difficulty = document.getElementById('difficulty').value;

  const rounds = document.getElementById('rounds').value;
  GameState.totalRounds = rounds === 'infinite' ? 999 : parseInt(rounds, 10);

  let playersHTML = '';
  const avatars = ['üë®', 'üë©', 'üë¶', 'üëß', 'üë¥', 'üëµ', 'üßë', 'üßí'];

  for (let i = 0; i < numPlayers; i++) {
    const defaultNames = ['Papai', 'Mam√£e', 'Filho(a)', 'Vov√¥', 'Vov√≥', 'Tio(a)', 'Primo(a)', 'Amigo(a)'];
    const team = GameState.mode === 'teams'
      ? (i < Math.ceil(numPlayers / 2) ? 'üë¶ Crian√ßas' : 'üë® Adultos')
      : null;

    playersHTML += `
      <div class="player-card">
        <span class="player-avatar">${avatars[i % avatars.length]}</span>
        <input type="text" class="setting-input player-name-input"
               placeholder="Nome do Jogador ${i + 1}"
               value="${defaultNames[i] || `Jogador ${i + 1}`}"
               style="text-align: center; font-weight: bold;">
        ${team ? `
          <div style="margin-top: 10px; padding: 5px 10px; background: ${team.includes('Crian√ßas') ? 'rgba(245, 158, 11, 0.2)' : 'rgba(59, 130, 246, 0.2)'};
                      border-radius: 10px; color: ${team.includes('Crian√ßas') ? '#f59e0b' : '#3b82f6'}; font-weight: bold;">
            ${team}
          </div>` : ''}
      </div>
    `;
  }

  document.getElementById('playersGrid').innerHTML = playersHTML;
  document.getElementById('welcomeScreen').classList.add('hidden');
  document.getElementById('playerSetup').classList.remove('hidden');
}

function generateQuestions() {
  const difficulty = GameState.difficulty || 'medium';
  let allQuestions = [];

  if (difficulty === 'mixed') {
    allQuestions = [...QuestionsDB.easy, ...QuestionsDB.medium, ...QuestionsDB.hard, ...QuestionsDB.expert];
  } else {
    allQuestions = [...(QuestionsDB[difficulty] || QuestionsDB.medium)];

    // adiciona perguntas de matem√°tica geradas
    for (let i = 0; i < 20; i++) allQuestions.push(generateMathQuestion(difficulty));
  }

  GameState.questions = shuffleArray([...allQuestions]);
  GameState.stats.totalQuestions = GameState.questions.length;
}

// ============================================
// JOGO
// ============================================
function startGame() {
  GameState.players = [];
  GameState.scores = [];
  GameState.streaks = [];
  GameState.powerUps = [];

  document.querySelectorAll('.player-name-input').forEach((input, index) => {
    const name = input.value.trim() || `Jogador ${index + 1}`;
    GameState.players.push(name);
    GameState.scores.push(0);
    GameState.streaks.push(0);
    GameState.powerUps.push({ help: 2, time: 1, double: 1, skip: 1 });
  });

  GameState.currentPlayer = 0;
  GameState.currentRound = 1;
  GameState.gameActive = true;
  GameState.gamePaused = false;
  GameState.usedQuestions.clear();
  GameState.doublePoints = false;
  GameState.timer = 30;

  GameState.stats = {
    totalQuestions: GameState.questions.length,
    correctAnswers: 0,
    fastestAnswer: 999,
    categories: {},
    powerUpsUsed: 0,
    hintsUsed: 0,
    startTime: Date.now(),
    achievements: new Set()
  };

  if (GameState.questions.length === 0) generateQuestions();

  document.getElementById('playerSetup').classList.add('hidden');
  document.getElementById('gameScreen').classList.remove('hidden');

  document.getElementById('totalRounds').textContent = GameState.totalRounds;
  document.getElementById('currentRound').textContent = 1;

  updateScoreboard();
  updatePowerUps();

  showNotification('üéÆ O jogo come√ßou! Boa sorte!', 'success');

  setTimeout(loadQuestion, 600);
}

function loadQuestion() {
  if (!GameState.gameActive || GameState.gamePaused) return;

  if (GameState.currentRound > GameState.totalRounds) {
    endGame();
    return;
  }

  let questionIndex;
  let attempts = 0;

  do {
    questionIndex = Math.floor(Math.random() * GameState.questions.length);
    attempts++;
    if (attempts > 200) { endGame(); return; }
  } while (GameState.usedQuestions.has(questionIndex));

  GameState.usedQuestions.add(questionIndex);
  const question = GameState.questions[questionIndex];
  if (!question) { endGame(); return; }

  const [text, options, correctIndex, category, points] = question;

  GameState.currentQuestionIndex = questionIndex;
  GameState.currentCorrectIndex = correctIndex;
  GameState.currentCategoryKey = category;
  GameState.currentPoints = points;
  GameState.questionStartAt = Date.now();

  const playerName = GameState.players[GameState.currentPlayer];
  document.getElementById('turnText').innerHTML =
    `üéÆ VEZ DE: <span style="color: var(--secondary);">${playerName.toUpperCase()}</span>`;
  document.getElementById('currentRound').textContent = GameState.currentRound;

  const categoryInfo = Categories[category] || Categories.curiosidades;
  document.getElementById('categoryDisplay').innerHTML =
    `<i class="fas ${categoryInfo.icon}"></i> ${categoryInfo.name}`;
  document.getElementById('categoryDisplay').style.backgroundColor = `${categoryInfo.color}20`;
  document.getElementById('categoryDisplay').style.color = categoryInfo.color;

  document.getElementById('questionDisplay').textContent = text;

  GameState.stats.categories[category] = (GameState.stats.categories[category] || 0) + 1;

  const answersContainer = document.getElementById('answersContainer');
  answersContainer.innerHTML = '';

  const letters = ['A', 'B', 'C', 'D'];
  options.forEach((option, index) => {
    const div = document.createElement('div');
    div.className = 'answer-option';
    div.innerHTML = `
      <span class="answer-letter">${letters[index]}</span>
      <span class="answer-content">${option}</span>
    `;
    div.onclick = () => checkAnswer(index, correctIndex, points, GameState.questionStartAt);
    answersContainer.appendChild(div);
  });

  updatePowerUps();
  GameState.timer = 30;
  startTimer();

  if (GameConfig.audioEnabled) {
    setTimeout(() => speak(`${playerName}, sua pergunta √©: ${text}`), 300);
  }
}

function checkAnswer(selectedIndex, correctIndex, points, startTime) {
  const answers = document.querySelectorAll('.answer-option');
  const responseTime = (Date.now() - startTime) / 1000;

  answers.forEach(a => { a.onclick = null; a.style.cursor = 'default'; });

  if (responseTime < GameState.stats.fastestAnswer) GameState.stats.fastestAnswer = responseTime;

  const playerName = GameState.players[GameState.currentPlayer];
  const playerIndex = GameState.currentPlayer;

  if (selectedIndex === correctIndex) {
    answers[selectedIndex].classList.add('correct');

    let totalPoints = GameState.doublePoints ? points * 2 : points;
    const timeBonus = GameState.timer > 15 ? 5 : 0;
    totalPoints += timeBonus;

    GameState.streaks[playerIndex]++;
    if (GameState.streaks[playerIndex] >= 3) totalPoints += 10;

    GameState.scores[playerIndex] += totalPoints;
    GameState.stats.correctAnswers++;
    GameState.doublePoints = false;

    const msg = `${playerName}! ${getRandomItem(MotivationalPhrases)} +${totalPoints} pontos!`;
    showNotification(msg, 'success');
    speak(msg);
  } else {
    answers[selectedIndex].classList.add('wrong');
    answers[correctIndex].classList.add('correct');

    GameState.streaks[playerIndex] = 0;
    GameState.doublePoints = false;

    if (GameState.mode === 'survival') {
      GameState.scores[playerIndex] = -999;
      showNotification(`‚ùå ${playerName} foi ELIMINADO do jogo!`, 'error');
    }

    const funny = getRandomItem(FunnyErrors);
    showNotification(`${playerName}, ${funny}`, 'error');
    speak(funny);
  }

  stopTimer();
  setTimeout(nextTurn, 1200);
}

function nextTurn() {
  if (!GameState.gameActive || GameState.gamePaused) return;

  GameState.currentPlayer = (GameState.currentPlayer + 1) % GameState.players.length;

  if (GameState.mode === 'survival') {
    const alive = GameState.players.filter((_, i) => GameState.scores[i] > -999);
    while (GameState.scores[GameState.currentPlayer] <= -999 && alive.length > 1) {
      GameState.currentPlayer = (GameState.currentPlayer + 1) % GameState.players.length;
    }
    if (alive.length === 1) { endGame(); return; }
  }

  if (GameState.currentPlayer === 0) {
    GameState.currentRound++;
    if (GameState.currentRound > GameState.totalRounds) { endGame(); return; }
  }

  updateScoreboard();
  loadQuestion();
}

function startTimer() {
  stopTimer();

  const timerFill = document.getElementById('timerFill');
  const timerText = document.getElementById('timerText');

  timerFill.style.width = '100%';
  timerText.textContent = `TEMPO: ${GameState.timer}s`;

  GameState.timerInterval = setInterval(() => {
    if (GameState.gamePaused) return;

    GameState.timer--;
    const percentage = (GameState.timer / 30) * 100;

    timerFill.style.width = `${Math.max(0, percentage)}%`;
    timerText.textContent = `TEMPO: ${Math.max(0, GameState.timer)}s`;

    if (GameState.timer <= 10) {
      timerFill.style.background = 'linear-gradient(90deg, var(--danger), #f87171)';
      timerText.style.color = 'var(--danger)';
    } else if (GameState.timer <= 20) {
      timerFill.style.background = 'linear-gradient(90deg, var(--warning), #fbbf24)';
      timerText.style.color = 'var(--warning)';
    } else {
      timerFill.style.background = 'linear-gradient(90deg, var(--success), #34d399)';
      timerText.style.color = 'var(--success)';
    }

    if (GameState.timer <= 0) timeUp();
  }, 1000);
}

function stopTimer() {
  if (GameState.timerInterval) {
    clearInterval(GameState.timerInterval);
    GameState.timerInterval = null;
  }
}

function timeUp() {
  stopTimer();

  const playerName = GameState.players[GameState.currentPlayer];
  showNotification(`‚è∞ TEMPO ESGOTADO! ${playerName} perdeu a vez.`, 'warning');
  speak("Tempo esgotado!");

  if (GameState.mode === 'survival') {
    GameState.scores[GameState.currentPlayer] = -999;
    showNotification(`${playerName} foi ELIMINADO por tempo esgotado!`, 'error');
  }

  setTimeout(nextTurn, 900);
}

function pauseGame() {
  if (!GameState.gameActive) return;

  GameState.gamePaused = !GameState.gamePaused;

  if (GameState.gamePaused) {
    showNotification('‚è∏Ô∏è JOGO PAUSADO', 'warning');
    document.querySelectorAll('.answer-option').forEach(btn => btn.style.pointerEvents = 'none');
  } else {
    showNotification('‚ñ∂Ô∏è JOGO RETOMADO', 'success');
    document.querySelectorAll('.answer-option').forEach(btn => btn.style.pointerEvents = 'auto');
  }
}

// ============================================
// POWER-UPS / DICAS
// ============================================
function usePowerUp(type) {
  const playerIndex = GameState.currentPlayer;
  const playerPowerUps = GameState.powerUps[playerIndex];
  const playerName = GameState.players[playerIndex];

  if (!playerPowerUps || playerPowerUps[type] <= 0) {
    showNotification(`‚ùå ${playerName} n√£o tem mais este power-up!`, 'error');
    return;
  }

  playerPowerUps[type]--;
  GameState.stats.powerUpsUsed++;

  switch (type) {
    case 'help': {
      const answers = Array.from(document.querySelectorAll('.answer-option'));
      if (GameState.currentCorrectIndex == null) {
        showNotification('‚ö†Ô∏è N√£o foi poss√≠vel usar a ajuda agora.', 'warning');
        break;
      }
      const wrong = answers.filter((_, idx) => idx !== GameState.currentCorrectIndex);
      shuffleArray(wrong);
      wrong.slice(0, 2).forEach(el => {
        el.style.opacity = '0.35';
        el.style.pointerEvents = 'none';
        el.style.textDecoration = 'line-through';
      });
      showNotification(`‚ùì ${playerName} usou AJUDA DA FAM√çLIA! 2 respostas eliminadas.`, 'info');
      speak("Ajuda da fam√≠lia ativada!");
      break;
    }
    case 'time':
      GameState.timer += 15;
      showNotification(`‚è±Ô∏è ${playerName} ganhou 15 SEGUNDOS EXTRAS!`, 'success');
      speak("Tempo extra!");
      break;

    case 'double':
      GameState.doublePoints = true;
      showNotification(`üíé ${playerName} ativou DUPLA PONTUA√á√ÉO!`, 'success');
      speak("Dupla pontua√ß√£o ativada!");
      break;

    case 'skip':
      showNotification(`‚è≠Ô∏è ${playerName} PULOU esta pergunta!`, 'warning');
      speak("Pergunta pulada!");
      stopTimer();
      setTimeout(nextTurn, 600);
      break;
  }

  updatePowerUps();
}

function updatePowerUps() {
  const playerIndex = GameState.currentPlayer;
  const powerUps = GameState.powerUps[playerIndex] || { help: 0, time: 0, double: 0, skip: 0 };

  document.getElementById('helpBtn').innerHTML = `<i class="fas fa-life-ring"></i> AJUDA (${powerUps.help})`;
  document.getElementById('timeBtn').innerHTML = `<i class="fas fa-clock"></i> TEMPO (${powerUps.time})`;
  document.getElementById('doubleBtn').innerHTML = `<i class="fas fa-gem"></i> DUPLO (${powerUps.double})`;
  document.getElementById('skipBtn').innerHTML = `<i class="fas fa-forward"></i> PULAR (${powerUps.skip})`;
}

function showHint() {
  const playerIndex = GameState.currentPlayer;
  const playerName = GameState.players[playerIndex];

  if (GameState.scores[playerIndex] >= 3) {
    GameState.scores[playerIndex] -= 3;
    GameState.stats.hintsUsed++;
    showNotification(`${playerName} usou uma DICA! -3 pontos. üí° Pense com calma!`, 'info');
    speak("Dica ativada!");
    updateScoreboard();
  } else {
    showNotification(`‚ùå ${playerName} n√£o tem pontos suficientes para dica!`, 'error');
  }
}

// ============================================
// UI
// ============================================
function updateScoreboard() {
  const scoreList = document.getElementById('scoreList');

  const ranked = GameState.players.map((player, index) => ({
    player,
    index,
    score: GameState.scores[index],
    streak: GameState.streaks[index],
    eliminated: GameState.scores[index] <= -999
  }));

  ranked.sort((a, b) => {
    if (a.eliminated && !b.eliminated) return 1;
    if (!a.eliminated && b.eliminated) return -1;
    return b.score - a.score;
  });

  scoreList.innerHTML = ranked.map((item, rank) => {
    const isCurrent = item.index === GameState.currentPlayer;
    const streakBadge = item.streak >= 3 ? `<span style="color: var(--danger); font-weight: bold;"> üî•${item.streak}</span>` : '';
    const pos = rank === 0 ? 'ü•á' : rank === 1 ? 'ü•à' : rank === 2 ? 'ü•â' : 'üîπ';

    return `
      <div class="score-item ${isCurrent ? 'current' : ''}" style="${item.eliminated ? 'opacity:0.5;text-decoration:line-through;' : ''}">
        <div class="score-player">
          ${pos} ${item.player} ${streakBadge} ${isCurrent ? '<span style="color: var(--warning);">üéÆ</span>' : ''}
        </div>
        <div class="score-points">
          ${item.eliminated ? '‚ùå ELIMINADO' : `${item.score} pts`}
        </div>
      </div>
    `;
  }).join('');
}

function confirmQuit() {
  if (confirm('Tem certeza que deseja sair? Todo o progresso ser√° perdido.')) backToMenu();
}

// ============================================
// FIM DE JOGO
// ============================================
function endGame() {
  GameState.gameActive = false;
  stopTimer();

  const validScores = GameState.scores.filter(s => s > -999);
  const maxScore = validScores.length ? Math.max(...validScores) : 0;

  const winners = GameState.players.filter((_, i) => GameState.scores[i] === maxScore);

  if (winners.length === 1) saveRecord(maxScore, winners[0], GameState.mode, GameState.difficulty);

  document.getElementById('gameScreen').classList.add('hidden');
  document.getElementById('resultsScreen').classList.remove('hidden');

  const winnerCrown = document.getElementById('winnerCrown');
  const winnerTitle = document.getElementById('winnerTitle');
  const winnerScore = document.getElementById('winnerScore');

  if (winners.length === 1) {
    winnerCrown.textContent = 'üëë';
    winnerTitle.innerHTML = `üèÜ CAMPE√ÉO: <span style="color: var(--warning);">${winners[0].toUpperCase()}</span> üèÜ`;
    winnerScore.textContent = `Com ${maxScore} pontos!`;
    speak(`Parab√©ns ${winners[0]}! Voc√™ venceu com ${maxScore} pontos!`);
  } else if (winners.length > 1) {
    winnerCrown.textContent = 'üëëüëë';
    winnerTitle.innerHTML = `üèÜ EMPATE: <span style="color: var(--warning);">${winners.join(' e ').toUpperCase()}</span> üèÜ`;
    winnerScore.textContent = `Com ${maxScore} pontos cada!`;
    speak(`Empate! Parab√©ns a todos!`);
  } else {
    winnerCrown.textContent = 'üò¢';
    winnerTitle.textContent = `üéÆ FIM DE JOGO`;
    winnerScore.textContent = `Todos foram eliminados!`;
  }

  showGameStats();
  showAchievements();
  createConfetti();
}

function showGameStats() {
  const gameStats = document.getElementById('gameStats');
  const totalQuestions = GameState.usedQuestions.size;
  const accuracy = totalQuestions > 0 ? ((GameState.stats.correctAnswers / totalQuestions) * 100).toFixed(1) : 0;

  let topCategory = 'Nenhuma';
  let topCount = 0;
  for (const [cat, count] of Object.entries(GameState.stats.categories)) {
    if (count > topCount) { topCount = count; topCategory = Categories[cat]?.name || cat; }
  }

  const duration = GameState.stats.startTime ? Math.floor((Date.now() - GameState.stats.startTime) / 1000) : 0;
  const minutes = Math.floor(duration / 60);
  const seconds = duration % 60;

  gameStats.innerHTML = `
    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px;">
      <div style="background: rgba(30,41,59,0.7); padding:20px; border-radius:15px;">
        <h4 style="color: var(--info); margin-bottom:10px;"><i class="fas fa-chart-line"></i> DESEMPENHO</h4>
        <p><strong>Total de Perguntas:</strong> ${totalQuestions}</p>
        <p><strong>Acertos:</strong> ${GameState.stats.correctAnswers}</p>
        <p><strong>Precis√£o:</strong> ${accuracy}%</p>
        <p><strong>Tempo Mais R√°pido:</strong> ${Number(GameState.stats.fastestAnswer).toFixed(2)}s</p>
      </div>

      <div style="background: rgba(30,41,59,0.7); padding:20px; border-radius:15px;">
        <h4 style="color: var(--info); margin-bottom:10px;"><i class="fas fa-gamepad"></i> JOGO</h4>
        <p><strong>Modo:</strong> ${GameState.mode.toUpperCase()}</p>
        <p><strong>Dificuldade:</strong> ${GameState.difficulty.toUpperCase()}</p>
        <p><strong>Dura√ß√£o:</strong> ${minutes}m ${seconds}s</p>
        <p><strong>Categoria Mais Comum:</strong> ${topCategory}</p>
      </div>

      <div style="background: rgba(30,41,59,0.7); padding:20px; border-radius:15px;">
        <h4 style="color: var(--info); margin-bottom:10px;"><i class="fas fa-magic"></i> RECURSOS</h4>
        <p><strong>Power-ups Usados:</strong> ${GameState.stats.powerUpsUsed}</p>
        <p><strong>Dicas Usadas:</strong> ${GameState.stats.hintsUsed}</p>
        <p><strong>Rodadas Jogadas:</strong> ${Math.max(0, GameState.currentRound - 1)}</p>
        <p><strong>Jogadores:</strong> ${GameState.players.length}</p>
      </div>
    </div>
  `;
}

function unlockAchievement(key) {
  const a = Achievements[key];
  if (!a) return;
  showNotification(`üéñÔ∏è CONQUISTA: ${a.name}! ${a.description}`, 'success');
  speak(`Conquista desbloqueada: ${a.name}!`);
}

function showAchievements() {
  const achievementsList = document.getElementById('achievementsList');
  const achievementsDisplay = document.getElementById('achievementsDisplay');

  const earned = Array.from(GameState.stats.achievements).filter(k => Achievements[k]).map(k => Achievements[k]);
  if (earned.length === 0) { achievementsDisplay.style.display = 'none'; return; }

  achievementsDisplay.style.display = 'block';
  achievementsList.innerHTML = earned.map(a => `
    <div style="background: rgba(16,185,129,0.2); padding:15px; border-radius:10px; border-left:4px solid var(--success); margin:10px 0;">
      <div style="font-size: 1.2rem; margin-bottom: 5px;">${a.icon} ${a.name}</div>
      <div style="font-size: 0.95rem; color: #94a3b8;">${a.description}</div>
    </div>
  `).join('');
}

// ============================================
// NAVEGA√á√ÉO / RECORDES / STATS
// ============================================
function backToMenu() {
  GameState.gameActive = false;
  stopTimer();

  document.getElementById('playerSetup').classList.add('hidden');
  document.getElementById('gameScreen').classList.add('hidden');
  document.getElementById('resultsScreen').classList.add('hidden');
  document.getElementById('welcomeScreen').classList.remove('hidden');
}

function rematch() {
  GameState.scores = GameState.scores.map(() => 0);
  GameState.streaks = GameState.streaks.map(() => 0);
  GameState.currentPlayer = 0;
  GameState.currentRound = 1;
  GameState.gameActive = true;
  GameState.gamePaused = false;
  GameState.usedQuestions.clear();
  GameState.doublePoints = false;
  GameState.timer = 30;

  GameState.players.forEach((_, i) => GameState.powerUps[i] = { help: 2, time: 1, double: 1, skip: 1 });

  const keepAchievements = GameState.stats.achievements;
  GameState.stats = {
    totalQuestions: GameState.questions.length,
    correctAnswers: 0,
    fastestAnswer: 999,
    categories: {},
    powerUpsUsed: 0,
    hintsUsed: 0,
    startTime: Date.now(),
    achievements: keepAchievements
  };

  generateQuestions();

  document.getElementById('resultsScreen').classList.add('hidden');
  document.getElementById('gameScreen').classList.remove('hidden');

  updateScoreboard();
  updatePowerUps();

  showNotification('üîÑ REVANCHE! Nova partida come√ßando...', 'success');
  setTimeout(loadQuestion, 600);
}

function newGame() { backToMenu(); }

function loadRecords() {
  GameState.records = safeGetLocalStorage('familyShowRecords', []);
}

function showRecords() {
  const hallOfFame = document.getElementById('hallOfFame');
  const records = GameState.records || [];

  if (records.length === 0) {
    hallOfFame.innerHTML = '<p style="text-align:center; padding:40px; color: var(--warning);">Nenhum recorde ainda! Seja o primeiro!</p>';
  } else {
    hallOfFame.innerHTML = `
      <div class="scores-list">
        ${records.map((r, i) => {
          const medal = i === 0 ? 'ü•á' : i === 1 ? 'ü•à' : i === 2 ? 'ü•â' : `${i + 1}.`;
          return `
            <div class="score-item" style="margin-bottom:10px;">
              <div class="score-player">${medal} ${r.player}
                <small style="color:#94a3b8; font-size:0.9rem;">(${r.mode} - ${r.difficulty})</small>
              </div>
              <div class="score-points">${r.score} pts</div>
              <div style="font-size:0.8rem; color:#64748b;">${r.date}</div>
            </div>
          `;
        }).join('')}
      </div>
    `;
  }

  document.getElementById('recordsModal').style.display = 'flex';
}

function showQuickStats() {
  const statsList = document.getElementById('statsList');
  const quickStats = document.getElementById('quickStats');
  const records = GameState.records || [];

  if (records.length === 0) { quickStats.style.display = 'none'; return; }
  quickStats.style.display = 'block';

  const top3 = records.slice(0, 3);
  statsList.innerHTML = top3.map((r, i) => {
    const medal = ['ü•á', 'ü•à', 'ü•â'][i];
    return `
      <div style="display:flex;justify-content:space-between;align-items:center;padding:15px;margin:10px 0;background:rgba(30,41,59,0.7);border-radius:12px;">
        <div><strong>${medal} ${r.player}</strong><br><small>${r.mode} ‚Ä¢ ${r.date}</small></div>
        <div style="font-size:1.5rem;font-weight:bold;color:var(--warning);">${r.score}</div>
      </div>
    `;
  }).join('');
}

function shareResults() {
  const maxScore = Math.max(...GameState.scores);
  const winner = GameState.players[GameState.scores.indexOf(maxScore)] || 'Todos';
  const shareText = `üéÆ SHOW DA FAM√çLIA! ${winner} venceu com ${maxScore} pontos! Modo: ${GameState.mode.toUpperCase()} ‚Ä¢ Dificuldade: ${GameState.difficulty.toUpperCase()} ‚Ä¢ ${window.location.href}`;

  if (navigator.share) {
    navigator.share({ title: 'Show da Fam√≠lia', text: shareText, url: window.location.href })
      .catch(() => copyToClipboard(shareText));
  } else {
    copyToClipboard(shareText);
  }
}

function copyToClipboard(text) {
  navigator.clipboard.writeText(text)
    .then(() => showNotification('üìã Copiado para a √°rea de transfer√™ncia!', 'success'))
    .catch(() => showNotification('‚ùå N√£o foi poss√≠vel copiar', 'error'));
}

function showInstructions() { document.getElementById('instructionsModal').style.display = 'flex'; }
function closeModal(modalId) { document.getElementById(modalId).style.display = 'none'; }

// ============================================
// BOOT
// ============================================
document.addEventListener('DOMContentLoaded', () => {
  const style = document.createElement('style');
  style.textContent = `
    @keyframes notificationSlideIn {
      from { transform: translateX(-50%) translateY(-100px); opacity: 0; }
      to { transform: translateX(-50%) translateY(0); opacity: 1; }
    }
    @keyframes notificationSlideOut {
      from { transform: translateX(-50%) translateY(0); opacity: 1; }
      to { transform: translateX(-50%) translateY(-100px); opacity: 0; }
    }
  `;
  document.head.appendChild(style);

  window.addEventListener('click', (event) => {
    if (event.target.classList.contains('modal-overlay')) event.target.style.display = 'none';
  });

  initGame();
});
</script>
</body>
</html>
